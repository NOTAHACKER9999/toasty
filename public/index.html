<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Override Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ========= UV CONFIG ========= -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#0b0b0b;color:#fff;overflow:hidden}

/* ---------- HOME ---------- */
#home{
  position:absolute;inset:0;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  gap:22px;z-index:1
}
#home h1{color:red;letter-spacing:3px}
#home input{
  width:440px;padding:14px;
  font-size:18px;border-radius:30px;
  border:none;outline:none
}
.homeBtns{display:flex;gap:14px}
.homeBtns button{
  padding:12px 24px;
  background:#000;border:1px solid red;
  color:red;font-size:16px;
  cursor:pointer
}

/* ---------- OVERLAY ---------- */
#overlay{
  position:absolute;inset:0;
  display:none;flex-direction:column;
  background:#111;z-index:10
}

/* ---------- TOP BAR ---------- */
#topBar{
  height:46px;background:#161616;
  display:flex;align-items:center;
  padding:0 10px;gap:8px;z-index:20
}
#tabs{display:flex;gap:4px;flex:1}
.tab{
  background:#222;padding:6px 10px;
  border-radius:6px;cursor:pointer;
  display:flex;align-items:center;gap:6px;
  max-width:180px;overflow:hidden
}
.tab.active{background:#333}
.tab img{width:14px;height:14px}

#urlBar{
  flex:3;padding:7px 12px;
  border-radius:20px;border:none;
  outline:none;font-size:14px
}

#dots{font-size:20px;cursor:pointer;padding:4px 8px}
#closeBtn{
  background:red;color:black;
  border:none;padding:6px 10px;
  cursor:pointer
}

/* ---------- 3 DOT MENU ---------- */
#menu{
  position:absolute;top:46px;right:10px;
  background:#222;border-radius:10px;
  display:none;flex-direction:column;
  min-width:170px;z-index:30
}
#menu button{
  background:none;border:none;
  color:#fff;text-align:left;
  padding:10px 14px;cursor:pointer
}
#menu button:hover{background:#333}

/* ---------- BOOKMARK BAR ---------- */
#bookmarkBar{
  height:32px;background:#181818;
  display:flex;gap:6px;
  padding:4px 8px;overflow-x:auto
}
.bm{
  background:#222;padding:4px 10px;
  border-radius:6px;cursor:pointer;
  white-space:nowrap
}

/* ---------- CONTENT ---------- */
#content{position:relative;flex:1}
iframe{
  position:absolute;inset:0;
  width:100%;height:100%;
  border:none;background:#000
}

/* ---------- PANELS ---------- */
.panel{
  position:absolute;inset:60px;
  background:#111;border:1px solid #333;
  border-radius:14px;padding:20px;
  overflow:auto;z-index:25
}
.histItem{
  padding:10px;border-bottom:1px solid #333;
  cursor:pointer
}
.histItem:hover{background:#222}
</style>
</head>

<body>

<!-- ========= HOME ========= -->
<div id="home">
  <h1>SCHOOL OVERRIDE</h1>
  <input id="homeSearch" placeholder="Search or enter URL">
  <div class="homeBtns">
    <button onclick="openBrowser()">Browser</button>
    <button onclick="alert('Games coming soon')">Games</button>
    <button onclick="alert('Stuff coming soon')">Stuff</button>
  </div>
</div>

<!-- ========= OVERLAY ========= -->
<div id="overlay">

  <div id="topBar">
    <div id="tabs"></div>
    <input id="urlBar">
    <div id="dots">â‹®</div>
    <button id="closeBtn" onclick="closeBrowser()">X</button>
  </div>

  <div id="bookmarkBar"></div>

  <div id="menu" onmouseleave="menu.style.display='none'">
    <button onclick="newTab()">New Tab</button>
    <button onclick="openHistory()">History</button>
    <button onclick="openBookmarks()">Bookmarks</button>
    <button onclick="injectDevTools()">Dev Tools</button>
    <button onclick="alert('Settings soon')">Settings</button>
  </div>

  <div id="content"></div>
</div>

<script>
/* ========= ELEMENTS ========= */
const home=document.getElementById("home");
const overlay=document.getElementById("overlay");
const content=document.getElementById("content");
const tabsDiv=document.getElementById("tabs");
const urlBar=document.getElementById("urlBar");
const bookmarkBar=document.getElementById("bookmarkBar");
const menu=document.getElementById("menu");
const dots=document.getElementById("dots");
const homeSearch=document.getElementById("homeSearch");

/* ========= STATE ========= */
let tabs=[],activeTab=null;
let historyLog=JSON.parse(localStorage.getItem("history")||"[]");
let bookmarks=JSON.parse(localStorage.getItem("bookmarks")||"{}");
let typing=false,lastURL=null;

/* ========= HOME ========= */
homeSearch.onkeydown=e=>{
  if(e.key==="Enter"){
    openBrowser();
    newTab(homeSearch.value);
  }
};

/* ========= BROWSER ========= */
function openBrowser(){
  home.style.display="none";
  overlay.style.display="flex";
  if(!tabs.length) newTab();
}
function closeBrowser(){
  overlay.style.display="none";
  home.style.display="flex";
}

/* ========= TABS ========= */
function newTab(input="https://duckduckgo.com"){
  const iframe=document.createElement("iframe");
  const url = __uv$config.prefix + __uv$config.encodeUrl(
    input.startsWith("http") ? input : "https://duckduckgo.com/?q="+encodeURIComponent(input)
  );
  iframe.src=url;
  content.appendChild(iframe);

  const tab={iframe,url:input,title:"New Tab",icon:""};
  tabs.push(tab);
  setActive(tab);

  iframe.onload=()=>{
    try{
      const raw=iframe.contentWindow.location.href;
      const enc=raw.split(__uv$config.prefix)[1];
      const dec=__uv$config.decodeUrl(enc.replace(/^\/+/,""));
      tab.url=dec;
      tab.title=iframe.contentDocument.title||dec;
      tab.icon=iframe.contentDocument.querySelector("link[rel~='icon']")?.href||"";
      logHistory(dec);
      renderTabs();
    }catch{}
  };
}

function setActive(tab){
  tabs.forEach(t=>t.iframe.style.display="none");
  tab.iframe.style.display="block";
  activeTab=tab;
  renderTabs();
}

function renderTabs(){
  tabsDiv.innerHTML="";
  tabs.forEach(t=>{
    const d=document.createElement("div");
    d.className="tab"+(t===activeTab?" active":"");
    d.onclick=()=>setActive(t);
    if(t.icon){
      const i=document.createElement("img");
      i.src=t.icon;d.appendChild(i);
    }
    d.appendChild(document.createTextNode(t.title));
    tabsDiv.appendChild(d);
  });
}

/* ========= URL BAR ========= */
urlBar.onfocus=()=>typing=true;
urlBar.onblur=()=>typing=false;
urlBar.onkeydown=e=>{
  if(e.key==="Enter") newTab(urlBar.value);
};

setInterval(()=>{
  if(activeTab && !typing){
    try{
      const raw=activeTab.iframe.contentWindow.location.href;
      if(raw.includes(__uv$config.prefix)){
        const enc=raw.split(__uv$config.prefix)[1];
        const dec=__uv$config.decodeUrl(enc.replace(/^\/+/,""));
        urlBar.value=dec;
        logHistory(dec);
      }
    }catch{}
  }
},500);

/* ========= HISTORY ========= */
function logHistory(url){
  if(!url||url===lastURL) return;
  lastURL=url;
  historyLog.push({url,time:new Date().toLocaleString()});
  localStorage.setItem("history",JSON.stringify(historyLog));
}

function openHistory(){
  showPanel("History",p=>{
    const clear=document.createElement("button");
    clear.textContent="Clear History";
    clear.onclick=()=>{
      historyLog=[];
      localStorage.removeItem("history");
      openHistory();
    };
    p.appendChild(clear);

    historyLog.slice().reverse().forEach(h=>{
      const d=document.createElement("div");
      d.className="histItem";
      d.innerHTML=`<b>${h.url}</b><br><small>${h.time}</small>`;
      d.onclick=()=>newTab(h.url);
      p.appendChild(d);
    });
  });
}

/* ========= BOOKMARKS ========= */
function renderBookmarks(){
  bookmarkBar.innerHTML="";
  Object.keys(bookmarks).forEach(url=>{
    const b=document.createElement("div");
    b.className="bm";
    b.textContent=bookmarks[url];
    b.onclick=()=>newTab(url);
    bookmarkBar.appendChild(b);
  });
}
function openBookmarks(){
  showPanel("Bookmarks",p=>{
    Object.keys(bookmarks).forEach(url=>{
      p.innerHTML+=`<div>${bookmarks[url]}<br><small>${url}</small></div>`;
    });
  });
}

/* ========= PANELS ========= */
function showPanel(title,build){
  document.querySelectorAll(".panel").forEach(p=>p.remove());
  const p=document.createElement("div");
  p.className="panel";
  p.innerHTML=`<h2>${title}</h2>`;
  build(p);
  content.appendChild(p);
}

/* ========= MENU ========= */
dots.onclick=()=>{
  menu.style.display=menu.style.display==="flex"?"none":"flex";
};

/* ========= DEVTOOLS ========= */
function injectDevTools(){
  try{
    const d=activeTab.iframe.contentDocument;
    const s=d.createElement("script");
    s.src="//cdn.jsdelivr.net/npm/eruda";
    s.onload=()=>d.body.appendChild(
      Object.assign(d.createElement("script"),{textContent:"eruda.init();"})
    );
    d.body.appendChild(s);
  }catch{}
}

renderBookmarks();
</script>
</body>
</html>
