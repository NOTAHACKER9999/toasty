<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red & Black Browser with Auto URL</title>

<!-- UV Proxy -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        navigator.serviceWorker.register("/uv/sw.js", {
            scope: __uv$config.prefix,
        });
    });
}
</script>

<!-- Eruda DevTools -->
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>

<style>
body { margin:0; font-family:sans-serif; background:#141414; color:#fff; overflow:hidden; }
#browser-bar { position:absolute; top:0; left:0; width:100%; height:10vh; display:flex; align-items:center; padding:0 1em; background:#1f1f1f; border-bottom:2px solid #ff5555; box-sizing:border-box; }
#urlInput { flex:1; height:70%; font-size:4vh; padding-left:0.5em; border:none; outline:none; background:#25252a; color:#ff5555; border-radius:5px; }
#goButton { margin-left:0.5em; height:70%; padding:0 1em; font-size:4vh; border:none; border-radius:5px; background:#ff5555; color:#141414; cursor:pointer; }
#toolbar { display:flex; gap:0.5em; margin-left:1em; }
.toolbar-button { background:#ff5555; color:#141414; border:none; padding:0.5em 1em; font-size:3vh; cursor:pointer; border-radius:5px; }
.panel { position:absolute; top:10vh; left:0; width:20vw; height:90vh; background:#1f1f1f; border-right:1px solid #ff5555; padding:1em; box-sizing:border-box; overflow-y:auto; display:none; }
.panel h2 { margin-top:0; color:#ff5555; }
.panel button { width:100%; margin:0.5em 0; padding:0.5em; font-size:1em; background:#ff5555; color:#141414; border:none; cursor:pointer; border-radius:5px; }
#iframeWindow { position:absolute; top:10vh; left:0; width:100%; height:90vh; border:none; background:#fff; }
</style>
</head>

<body>

<div id="browser-bar">
    <input type="text" id="urlInput" placeholder="Enter URL here">
    <button id="goButton">Go</button>
    <div id="toolbar">
        <button class="toolbar-button" onclick="togglePanel('bookmarksPanel')">Bookmarks</button>
        <button class="toolbar-button" onclick="togglePanel('historyPanel')">History</button>
        <button class="toolbar-button" onclick="togglePanel('settingsPanel')">Settings</button>
        <button class="toolbar-button" onclick="eruda.toggle()">DevTools</button>
    </div>
</div>

<div id="bookmarksPanel" class="panel">
    <h2>Bookmarks</h2>
    <div id="bookmarksList"></div>
    <button onclick="addBookmark()">Add Current Page</button>
</div>

<div id="historyPanel" class="panel">
    <h2>History</h2>
    <div id="historyList"></div>
</div>

<div id="settingsPanel" class="panel">
    <h2>Settings</h2>
    <label style="color:#ff5555">Default Search Engine:</label>
    <select id="defaultSearchEngine">
        <option value="https://www.google.com/search?q=">Google</option>
        <option value="https://duckduckgo.com/?q=">DuckDuckGo</option>
        <option value="https://www.bing.com/search?q=">Bing</option>
    </select>
</div>

<iframe id="iframeWindow"></iframe>

<script>
const iframe = document.getElementById("iframeWindow");
const urlInput = document.getElementById("urlInput");
const goButton = document.getElementById("goButton");

const bookmarksList = document.getElementById("bookmarksList");
const historyList = document.getElementById("historyList");

let bookmarks = [];
let history = [];
let defaultSearch = document.getElementById("defaultSearchEngine").value;
let currentUnproxiedURL = "";

// Toggle panels
function togglePanel(id) {
    const panel = document.getElementById(id);
    panel.style.display = panel.style.display==='block' ? 'none':'block';
}

// Default search engine change
document.getElementById("defaultSearchEngine").addEventListener("change", (e)=>{
    defaultSearch = e.target.value;
});

// Load URL function
function loadURL(url) {
    let finalURL = url;
    if (!url.includes(".")) finalURL = defaultSearch + encodeURIComponent(url);
    else if (!url.startsWith("http://") && !url.startsWith("https://")) finalURL = "https://" + url;

    currentUnproxiedURL = finalURL; // store unproxied URL
    iframe.src = __uv$config.prefix + __uv$config.encodeUrl(finalURL);

    history.push(finalURL);
    renderHistory();
    urlInput.value = currentUnproxiedURL;
}

// Button and Enter key
goButton.onclick = ()=> loadURL(urlInput.value);
urlInput.addEventListener("keydown", e=> { if(e.key==='Enter') loadURL(urlInput.value); });

// Bookmarks
function addBookmark() { if(!bookmarks.includes(currentUnproxiedURL)) bookmarks.push(currentUnproxiedURL); renderBookmarks(); }
function renderBookmarks() { bookmarksList.innerHTML=""; bookmarks.forEach(url=>{ const btn=document.createElement("button"); btn.textContent=url; btn.onclick=()=> loadURL(url); bookmarksList.appendChild(btn); }); }

// History
function renderHistory() { historyList.innerHTML=""; history.forEach(url=>{ const btn=document.createElement("button"); btn.textContent=url; btn.onclick=()=> loadURL(url); historyList.appendChild(btn); }); }

// Auto-update URL bar
iframe.addEventListener("load", ()=>{
    try{
        const current = iframe.contentWindow.location.href;
        if(current.startsWith(__uv$config.prefix)){
            // Decode UV proxy URL to get original
            const decoded = __uv$config.decodeUrl(current);
            currentUnproxiedURL = decoded;
            urlInput.value = currentUnproxiedURL;
        } else {
            // Fallback
            urlInput.value = currentUnproxiedURL;
        }
    }catch(e){
        // Cross-origin fallback
        urlInput.value = currentUnproxiedURL;
    }
});
</script>

</body>
</html>
