<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub Proxy Browser</title>

<!-- UV Proxy Scripts -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/uv/sw.js", {
      scope: __uv$config.prefix
    });
  });
}
</script>

<style>
:root{
  --bg:#0a0a0a;
  --panel:#121212;
  --border:#333;
  --accent:#ffffff;
  --text:#ffffff;
  --urlbar-bg:#000;
  --urlbar-outline:#fff;
  --btn-bg:#111;
  --btn-hover:#222;
}

/* Reset */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden;}

/* Tabs */
#tabsBar{display:flex;align-items:flex-end;gap:2px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);}
.tab{position:relative;padding:10px 16px;background:var(--btn-bg);color:var(--text);border-top-left-radius:6px;border-top-right-radius:6px;cursor:pointer;display:flex;align-items:center;gap:6px;}
.tab.active{background:var(--bg);border-bottom:1px solid var(--bg);font-weight:700;}
.tab .close{margin-left:6px;font-weight:900;cursor:pointer;}
.tab + .tab{margin-left:-2px;}

/* Browser Bar */
#browserBar{display:flex;align-items:center;gap:6px;padding:6px;background:var(--btn-bg);border-bottom:1px solid var(--border);}
.bubble-btn{padding:6px 12px;border-radius:4px;background:var(--btn-bg);border:1px solid var(--urlbar-outline);cursor:pointer;color:var(--text);}
.bubble-btn:hover{background:var(--btn-hover);}
#urlBar{flex:1;padding:6px 12px;background:var(--urlbar-bg);border:1px solid var(--urlbar-outline);border-radius:4px;color:var(--text);outline:none;font-family:monospace;font-size:0.9rem;}

/* Bookmark Bar */
#bookmarkBar{display:flex;gap:4px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);overflow-x:auto;}
.bookmark-btn{padding:4px 10px;background:var(--btn-bg);color:var(--text);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:0.85rem;}
.bookmark-btn:hover{background:var(--btn-hover);}

/* Frames */
#frames{flex:1;position:relative;}
.proxyFrame{position:absolute;inset:0;width:100%;height:100%;border:none;display:none;}
.proxyFrame.active{display:block}
</style>
</head>

<body>

<!-- Tabs -->
<div id="tabsBar">
  <div class="tab" onclick="newTab()">＋</div>
</div>

<!-- Browser Bar -->
<div id="browserBar">
  <div class="bubble-btn" onclick="goBack()">⟵</div>
  <div class="bubble-btn" onclick="goForward()">⟶</div>
  <div class="bubble-btn" onclick="refreshTab()">⟳</div>
  <input id="urlBar" spellcheck="false" placeholder="Enter URL">
  <div class="bubble-btn" onclick="fullscreenTab()">⛶</div>
  <div class="bubble-btn" onclick="injectCode()">{"</>"}</div>
  <div class="bubble-btn" onclick="closeOverlay()">✕</div>
</div>

<!-- Bookmark Bar -->
<div id="bookmarkBar"></div>

<!-- Frames -->
<div id="frames"></div>

<script>
const tabsBar = document.getElementById("tabsBar");
const frames = document.getElementById("frames");
const urlBar = document.getElementById("urlBar");
const bookmarkBar = document.getElementById("bookmarkBar");

let tabs = [], active = null;

// ===== URL NORMALIZER =====
function normalize(input){
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

// ===== CREATE NEW TAB =====
function newTab(url="https://www.startpage.com"){
  const iframe = document.createElement("iframe");
  iframe.className="proxyFrame";

  const tab = document.createElement("div");
  tab.className="tab";
  const title = document.createElement("span");
  title.textContent="New Tab";

  const close = document.createElement("span");
  close.textContent="✕";
  close.className="close";
  close.onclick=e=>{e.stopPropagation(); closeTab(tabObj)};

  const tabObj={iframe, tab, title, url};
  tab.onclick=()=>activate(tabObj);
  tab.append(title, close);

  tabs.splice(tabs.length-1,0,tabObj);
  tabsBar.insertBefore(tab, tabsBar.lastElementChild);
  frames.appendChild(iframe);

  iframe.src = __uv$config.prefix + __uv$config.encodeUrl(url);
  overlayShow();
  activate(tabObj);
}

// ===== ACTIVATE TAB =====
function activate(t){
  tabs.forEach(x=>{x.iframe.classList.remove("active"); x.tab.classList.remove("active");});
  active = t;
  t.iframe.classList.add("active");
  t.tab.classList.add("active");

  // Update browser bar with unproxied link
  try{
    const w = t.iframe.contentWindow;
    let href = t.url; // default
    if(w.location.href.includes(__uv$config.prefix)){
      const encoded = w.location.href.split(__uv$config.prefix)[1];
      href = __uv$config.decodeUrl(encoded.replace(/^\/+/,''));
    }
    urlBar.value = href;
  }catch{urlBar.value = t.url;}
}

// ===== CLOSE TAB =====
function closeTab(t){
  const i = tabs.indexOf(t);
  if(i>-1){t.iframe.remove(); t.tab.remove(); tabs.splice(i,1); activate(tabs[i-1]||tabs[0]);}
}

// ===== NAVIGATION =====
function goBack(){active?.iframe.contentWindow.history.back()}
function goForward(){active?.iframe.contentWindow.history.forward()}
function refreshTab(){active?.iframe.contentWindow.location.reload()}
function fullscreenTab(){active?.iframe.requestFullscreen?.()}

// ===== INJECT DEVTOOLS =====
function injectCode(){
  if(!active) return;
  const code = `javascript:(function () {
    var script=document.createElement('script');
    script.src="//cdn.jsdelivr.net/npm/eruda";
    document.body.appendChild(script);
    script.onload = function () { eruda.init(); }
  })();`;
  active.iframe.contentWindow.eval(code);
}

// ===== BOOKMARKLET INJECTION =====
function injectBookmarklet(code){
  if(!active) return;
  active.iframe.contentWindow.eval(code);
}

// ===== URL BAR ENTER =====
urlBar.addEventListener("keydown", e => {
  if(e.key==="Enter" && active){
    active.url = normalize(urlBar.value.trim());
    active.iframe.src = __uv$config.prefix + __uv$config.encodeUrl(active.url);
  }
});

// ===== ADD BOOKMARK =====
function addBookmark(name, code){
  const btn = document.createElement("div");
  btn.className="bookmark-btn";
  btn.textContent = name;
  btn.onclick = ()=>injectBookmarklet(code);
  bookmarkBar.appendChild(btn);
}

// ===== SHOW PROXY FRAMES =====
function overlayShow(){frames.style.display="block";}
function closeOverlay(){frames.style.display="none";}

// ===== INITIAL TAB =====
newTab();

</script>
</body>
</html>
