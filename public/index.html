<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Override Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= ULTRAVIOLET ================= -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>

<style>
:root{
  --bg:#0b0b0c;
  --bar:#111;
  --bar2:#141414;
  --tab:#1a1a1a;
  --active:#1f1f1f;
  --border:#2a2a2a;
  --text:#fff;
  --muted:#aaa;
}

*{box-sizing:border-box;font-family:system-ui}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  overflow:hidden;
}

/* ===== HOME ===== */
#home{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:20px;
}

#home h1{
  color:#f00;
  letter-spacing:2px;
}

#home input{
  width:420px;
  padding:14px;
  background:#000;
  color:#fff;
  border:1px solid var(--border);
}

#home .buttons{
  display:flex;
  gap:16px;
}

#home button{
  padding:12px 24px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  cursor:pointer;
}

/* ===== OVERLAY ===== */
#overlay{
  position:fixed;
  inset:0;
  display:none;
  flex-direction:column;
  background:var(--bg);
}

/* ===== TABS ===== */
#tabsBar{
  display:flex;
  align-items:flex-end;
  background:var(--bar);
  border-bottom:1px solid var(--border);
  padding-left:6px;
}

.tab{
  display:flex;
  align-items:center;
  gap:6px;
  background:var(--tab);
  padding:8px 10px;
  max-width:2in;
  min-width:90px;
  overflow:hidden;
  cursor:pointer;
  border-right:1px solid var(--border);
}

.tab.active{
  background:var(--active);
}

.tab img{
  width:14px;
  height:14px;
}

.tab span{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  font-size:13px;
}

.tab .close{
  margin-left:auto;
  color:#fff;
  cursor:pointer;
}

#newTab{
  padding:8px 12px;
  cursor:pointer;
  color:#fff;
}

/* ===== NAV BAR ===== */
#navBar{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px;
  background:var(--bar2);
}

#navBar button{
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
}

#urlWrap{
  flex:1;
  display:flex;
  align-items:center;
  background:#000;
  border:1px solid #fff;
}

#url{
  flex:1;
  padding:6px;
  background:none;
  color:#fff;
  border:none;
  outline:none;
}

#star{
  padding:0 10px;
  cursor:pointer;
  font-size:18px;
}

/* ===== BOOKMARK BAR ===== */
#bookmarks{
  position:absolute;
  top:74px;
  left:0;
  right:0;
  background:#000;
  border-bottom:1px solid var(--border);
  display:flex;
  gap:16px;
  padding:10px;
  z-index:10;
}

.bookmark{
  font-size:13px;
  cursor:pointer;
}

.bookmark[contenteditable]{
  outline:1px dashed #555;
}

/* ===== FRAMES ===== */
#frames{
  flex:1;
  position:relative;
}

iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
}

iframe.active{
  display:block;
}

/* ===== CLOSE ===== */
#closeOverlay{
  position:absolute;
  top:6px;
  right:10px;
  cursor:pointer;
  color:#fff;
  z-index:20;
}
</style>
</head>

<body>

<!-- ================= HOME ================= -->
<div id="home">
  <h1>WELCOME</h1>

  <input id="homeSearch" placeholder="Search or enter URL">

  <div class="buttons">
    <button onclick="openBrowser()">Browser</button>
    <button onclick="location.href='../games/index.html'">Games</button>
  </div>
</div>

<!-- ================= BROWSER ================= -->
<div id="overlay">
  <div id="closeOverlay">✕</div>

  <div id="tabsBar">
    <div id="newTab">+</div>
  </div>

  <div id="navBar">
    <button id="back">←</button>
    <button id="forward">→</button>
    <button id="reload">⟳</button>

    <div id="urlWrap">
      <input id="url">
      <div id="star">☆</div>
    </div>

    <button id="dev">&lt;/&gt;</button>
    <button id="fs">⛶</button>
  </div>

  <div id="bookmarks"></div>
  <div id="frames"></div>
</div>

<script>
/* ===== ELEMENTS ===== */
const home=document.getElementById("home");
const overlay=document.getElementById("overlay");
const frames=document.getElementById("frames");
const tabsBar=document.getElementById("tabsBar");
const newTabBtn=document.getElementById("newTab");
const urlBar=document.getElementById("url");
const star=document.getElementById("star");
const bookmarksBar=document.getElementById("bookmarks");

let tabs=[], active=null;
let bookmarks=JSON.parse(localStorage.getItem("bm")||"{}");

/* ===== HELPERS ===== */
function normalize(input){
  if(!input) return "";
  if(input.startsWith("javascript:")) return input;
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

function navigate(tab,raw){
  const url=normalize(raw);
  tab.url=url;
  if(url.startsWith("javascript:")){
    tab.iframe.contentWindow.eval(url.slice(11));
    return;
  }
  tab.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);
}

/* ===== TABS ===== */
function openBrowser(){
  overlay.style.display="flex";
  home.style.display="none";
  if(!tabs.length) newTab();
}

function newTab(url=""){
  const iframe=document.createElement("iframe");
  frames.appendChild(iframe);

  const tab=document.createElement("div");
  tab.className="tab";

  const ico=document.createElement("img");
  const title=document.createElement("span");
  title.textContent="New Tab";
  const close=document.createElement("span");
  close.textContent="✕";
  close.className="close";

  tab.append(ico,title,close);
  tabsBar.insertBefore(tab,newTabBtn);

  const obj={iframe,tab,title,ico,url:""};
  tabs.push(obj);

  tab.onclick=()=>activate(obj);
  close.onclick=e=>{
    e.stopPropagation();
    tabs=tabs.filter(t=>t!==obj);
    frames.removeChild(iframe);
    tabsBar.removeChild(tab);
    if(active===obj && tabs[0]) activate(tabs[0]);
  };

  iframe.onload=()=>{
    try{
      const d=iframe.contentDocument;
      title.textContent=d.title||"Tab";
      const f=d.querySelector("link[rel~='icon']");
      if(f) ico.src=f.href;
    }catch{}
  };

  activate(obj);
  if(url) navigate(obj,url);
}

function activate(tab){
  tabs.forEach(t=>{
    t.iframe.classList.remove("active");
    t.tab.classList.remove("active");
  });
  active=tab;
  tab.iframe.classList.add("active");
  tab.tab.classList.add("active");
  urlBar.value=tab.url||"";
  updateStar();
}

/* ===== BOOKMARKS ===== */
function renderBookmarks(){
  bookmarksBar.innerHTML="";
  for(const url in bookmarks){
    const b=document.createElement("div");
    b.className="bookmark";
    b.textContent=bookmarks[url];

    b.onclick=()=>navigate(active,url);
    b.ondblclick=()=>{
      b.contentEditable=true;
      b.focus();
    };
    b.onblur=()=>{
      b.contentEditable=false;
      bookmarks[url]=b.textContent.trim();
      localStorage.setItem("bm",JSON.stringify(bookmarks));
    };
    bookmarksBar.appendChild(b);
  }
}

function updateStar(){
  star.textContent=(active && bookmarks[active.url])?"★":"☆";
}

star.onclick=()=>{
  if(!active||!active.url) return;
  if(bookmarks[active.url]) delete bookmarks[active.url];
  else bookmarks[active.url]=active.url;
  localStorage.setItem("bm",JSON.stringify(bookmarks));
  renderBookmarks();
  updateStar();
};

/* ===== CONTROLS ===== */
urlBar.onkeydown=e=>{
  if(e.key==="Enter"&&active) navigate(active,urlBar.value);
};

homeSearch.onkeydown=e=>{
  if(e.key==="Enter"){
    openBrowser();
    newTab(homeSearch.value);
  }
};

document.getElementById("reload").onclick=()=>active&&active.iframe.contentWindow.location.reload();
document.getElementById("back").onclick=()=>active&&active.iframe.contentWindow.history.back();
document.getElementById("forward").onclick=()=>active&&active.iframe.contentWindow.history.forward();

document.getElementById("fs").onclick=()=>{
  if(!document.fullscreenElement) document.body.requestFullscreen();
  else document.exitFullscreen();
};

document.getElementById("closeOverlay").onclick=()=>{
  overlay.style.display="none";
  home.style.display="flex";
};

newTabBtn.onclick=()=>newTab();

/* ===== URL DECODE LOOP ===== */
setInterval(()=>{
  if(!active) return;
  try{
    const h=active.iframe.contentWindow.location.href;
    if(!h.includes(__uv$config.prefix)) return;
    const enc=h.split(__uv$config.prefix)[1];
    const dec=__uv$config.decodeUrl(enc.replace(/^\/+/,""));
    if(dec && document.activeElement!==urlBar){
      active.url=dec;
      urlBar.value=dec;
      updateStar();
    }
  }catch{}
},400);

renderBookmarks();
</script>
</body>
</html>
