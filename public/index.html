<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub</title>

<!-- ===== UV PROXY ===== -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
  });
}
</script>

<style>
:root {
  --bg:#050505; --panel:#0f0f0f; --border:#2a2a2a; --accent:#ff2d2d; --text:#e0e0e0;
  --tab-bg:#111; --tab-active:#222; --bookmark-btn-bg:#111;
}

/* ===== RESET ===== */
*{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Arial,sans-serif;}
body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}
button{cursor:pointer;}

/* ===== HEADER ===== */
header{padding:16px;text-align:center;font-size:2rem;font-weight:700;background:var(--panel);border-bottom:1px solid var(--border);}
nav{display:flex;justify-content:center;gap:18px;padding:10px;background:var(--panel);border-bottom:1px solid var(--border);}
.nav-btn{padding:10px 18px;border-radius:12px;background:var(--tab-bg);color:var(--text);transition:.3s;}
.nav-btn:hover{background:var(--tab-active);}

/* ===== MAIN SEARCH ===== */
main{flex:1;display:flex;justify-content:center;align-items:center;padding:40px;}
#searchInput{width:100%;max-width:600px;padding:16px 20px;background:#111;border:1px solid var(--border);color:var(--text);border-radius:999px;font-size:1.1rem;outline:none;text-align:center;}

/* ===== FOOTER ===== */
footer{padding:12px;text-align:center;background:var(--panel);border-top:1px solid var(--border);font-size:.85rem;color:#aaa;}

/* ===== PROXY OVERLAY ===== */
#proxyOverlay{position:fixed;inset:0;background:var(--bg);display:none;flex-direction:column;z-index:9999;}
#tabsBar{display:flex;gap:2px;padding:2px;background:var(--panel);border-bottom:1px solid var(--border);overflow-x:auto;align-items:center;position:relative;}
.tab{display:flex;align-items:center;gap:4px;padding:6px 12px;background:var(--tab-bg);border-radius:6px;max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative;transition:.2s;}
.tab.active{background:var(--tab-active);}
.tab img{width:16px;height:16px;}
.tab .close{position:absolute;right:2px;top:2px;color:#fff;font-weight:900;font-size:12px;cursor:pointer;}

/* ===== CLOSE OVERLAY BUTTON ===== */
#closeOverlayBtn{position:absolute;right:2px;top:2px;color:#fff;font-weight:900;font-size:16px;cursor:pointer;}

/* ===== BROWSER BAR ===== */
#browserBar{display:flex;align-items:center;gap:8px;padding:8px;background:var(--panel);border-bottom:1px solid var(--border);}
#urlWrapper{flex:1;position:relative;}
#urlBar{width:100%;padding:8px 16px;background:#111;border:1px solid #fff;border-radius:6px;font-family:monospace;font-size:.85rem;color:#fff;outline:none;}
#bookmarkStar{position:absolute;right:4px;top:50%;transform:translateY(-50%);padding:0 4px;background:none;border:none;color:#fff;font-size:16px;cursor:pointer;}

/* ===== NAV BUTTONS ===== */
.bubble-btn{padding:6px 10px;border-radius:6px;background:var(--tab-bg);color:#fff;border:none;transition:.3s;}
.bubble-btn:hover{background:var(--tab-active);}
#fullscreenBtn,#devBtn{margin-left:4px;}

/* ===== BOOKMARK BAR ===== */
#bookmarkBar{display:flex;gap:4px;background:var(--panel);padding:4px 6px;border-bottom:1px solid var(--border);min-height:40px;}
.bookmark-btn{padding:6px 12px;background:var(--tab-bg);border-radius:6px;color:#fff;display:flex;align-items:center;gap:4px;white-space:nowrap;cursor:pointer;}
.bookmark-btn:hover{background:var(--tab-active);}
.bookmark-btn button{margin-left:4px;background:transparent;border:none;color:#ff2d2d;font-weight:700;cursor:pointer;}

/* ===== FRAMES ===== */
#frames{flex:1;position:relative;}
.proxyFrame{position:absolute;inset:0;width:100%;height:100%;border:none;display:none;}
.proxyFrame.active{display:block}

/* ===== MODALS ===== */
#bookmarkModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:10001;justify-content:center;align-items:center;}
#bookmarkModal input{display:block;margin-bottom:10px;padding:8px;border-radius:6px;border:none;width:300px;outline:none;}
#bookmarkModal button{padding:6px 10px;border-radius:6px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer;}
</style>
</head>
<body>

<header>Glitch Hub</header>

<!-- HOME PAGE -->
<main id="homePage">
  <div style="display:flex;flex-direction:column;align-items:center;gap:20px;">
    <div class="nav-btn" onclick="openNav('../games/app.html')">Games</div>
    <div class="nav-btn" onclick="openNav('../movies/index.html')">Movies</div>
    <div class="nav-btn" onclick="openNav('../ai/index.html')">AI</div>
    <div class="nav-btn" onclick="openNav('../tools/index.html')">Tools</div>
    <input id="searchInput" placeholder="Search or enter URL (press Enter)">
  </div>
</main>

<footer>© 2025 Glitch Override</footer>

<!-- ===== PROXY OVERLAY ===== -->
<div id="proxyOverlay">
  <div id="tabsBar">
    <div class="tab" onclick="newTab()">＋</div>
    <div id="closeOverlayBtn" onclick="closeOverlay()">✕</div>
  </div>
  <div id="browserBar">
    <div class="bubble-btn" onclick="goBack()">⟵</div>
    <div class="bubble-btn" onclick="goForward()">⟶</div>
    <div class="bubble-btn" onclick="refreshTab()">⟳</div>
    <div id="urlWrapper">
      <input id="urlBar" spellcheck="false">
      <button id="bookmarkStar" onclick="toggleBookmark()">☆</button>
    </div>
    <div class="bubble-btn" id="fullscreenBtn" onclick="fullscreenTab()">⛶</div>
    <div class="bubble-btn" id="devBtn" onclick="injectCode()">&lt;/&gt;</div>
  </div>
  <div id="bookmarkBar"></div>
  <div id="frames"></div>
</div>

<!-- ===== BOOKMARK MODAL ===== -->
<div id="bookmarkModal">
  <div style="background:#111;padding:20px;border-radius:10px;display:flex;flex-direction:column;align-items:center;">
    <input type="text" id="bookmarkName" placeholder="Bookmark Name">
    <input type="text" id="bookmarkCode" placeholder="Bookmarklet JS Code or URL">
    <div style="display:flex;gap:10px;">
      <button onclick="saveBookmark()">Save</button>
      <button onclick="closeBookmarkModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
const overlay=document.getElementById("proxyOverlay");
const tabsBar=document.getElementById("tabsBar");
const frames=document.getElementById("frames");
const urlBar=document.getElementById("urlBar");
const searchInput=document.getElementById("searchInput");
const fullscreenBtn=document.getElementById("fullscreenBtn");
const devBtn=document.getElementById("devBtn");
const bookmarkStar=document.getElementById("bookmarkStar");
const bookmarkBar=document.getElementById("bookmarkBar");
const bookmarkModal=document.getElementById("bookmarkModal");
const bookmarkNameInput=document.getElementById("bookmarkName");
const bookmarkCodeInput=document.getElementById("bookmarkCode");
const homePage=document.getElementById("homePage");

let tabs=[],active=null,editingUrl=false,bookmarks=[];

// ===== URL NORMALIZER =====
function normalize(input){ 
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

// ===== HOME SEARCH =====
searchInput.addEventListener("keydown",e=>{
  if(e.key==="Enter"){ newTab(normalize(searchInput.value.trim())); }
});

// ===== NAV BUTTONS =====
function openNav(path){ newTab(location.origin+path.replace(/^.\//,"/")); }

// ===== TABS =====
function newTab(url=normalize("startpage.com")) {
  homePage.style.display="none";
  const iframe=document.createElement("iframe");
  iframe.className="proxyFrame";

  const tab=document.createElement("div");
  tab.className="tab";
  const icon=document.createElement("img"); icon.src="data:image/svg+xml;base64,PHN2Zy8+";
  const title=document.createElement("span"); title.textContent="New Tab";
  const close=document.createElement("span"); close.textContent="✕"; close.className="close";
  const tabObj={iframe,tab,icon,title,url};
  close.onclick=e=>{e.stopPropagation();closeTab(tabObj)};
  tab.onclick=()=>activate(tabObj);
  tab.append(icon,title,close);
  tabs.splice(tabs.length-1,0,tabObj);
  tabsBar.insertBefore(tab,tabsBar.firstElementChild.nextSibling);
  frames.appendChild(iframe);
  overlay.style.display="flex";
  activate(tabObj);
  iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);
}

// ===== ACTIVATE TAB =====
function activate(t){
  tabs.forEach(x=>{x.iframe.classList.remove("active"); x.tab.classList.remove("active");});
  active=t;
  t.iframe.classList.add("active"); t.tab.classList.add("active");
  urlBar.value=t.url;
  updateBookmarkStar();
}

// ===== CLOSE TAB =====
function closeTab(t){
  const i=tabs.indexOf(t);
  if(i>-1){ t.iframe.remove(); t.tab.remove(); tabs.splice(i,1); activate(tabs[i-1]||tabs[0]); }
  if(tabs.length===0){ overlay.style.display="none"; homePage.style.display="flex"; }
}

// ===== NAV CONTROLS =====
function goBack(){active?.iframe.contentWindow.history.back();}
function goForward(){active?.iframe.contentWindow.history.forward();}
function refreshTab(){active?.iframe.contentWindow.location.reload();}
function fullscreenTab(){active?.iframe.requestFullscreen?.();}
function injectCode(){
  if(!active) return;
  const code=`javascript:(function(){var script=document.createElement('script');script.src="//cdn.jsdelivr.net/npm/eruda";document.body.appendChild(script);script.onload=function(){eruda.init();}})();`;
  active.iframe.contentWindow.eval(code);
}

// ===== URL BAR LIVE =====
urlBar.addEventListener("keydown", e=>{
  if(e.key==="Enter" && active){
    e.preventDefault();
    const newUrl=urlBar.value.trim();
    active.url=newUrl;
    active.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(newUrl);
    updateBookmarkStar();
  }
});

// ===== BOOKMARKS =====
function renderBookmarks(){
  bookmarkBar.innerHTML="";
  bookmarks.forEach((b, idx)=>{
    const wrapper=document.createElement("div"); wrapper.style.display="flex"; wrapper.style.alignItems="center";
    const btn=document.createElement("div"); btn.className="bookmark-btn"; btn.textContent=b.name;
    btn.onclick=()=>{ newTab(b.code); };
    let pressTimer;
    btn.addEventListener("mousedown",()=>{ pressTimer=setTimeout(()=>{ openBookmarkModal(idx); },700); });
    btn.addEventListener("mouseup",()=>{ clearTimeout(pressTimer); });
    btn.addEventListener("mouseleave",()=>{ clearTimeout(pressTimer); });
    const delBtn=document.createElement("button"); delBtn.textContent="✕";
    delBtn.onclick=()=>{ bookmarks.splice(idx,1); renderBookmarks(); updateBookmarkStar(); };
    wrapper.appendChild(btn); wrapper.appendChild(delBtn);
    bookmarkBar.appendChild(wrapper);
  });
}

function toggleBookmark(){
  if(!active) return;
  const existing=bookmarks.find(b=>b.code===active.url);
  if(existing){ bookmarks=bookmarks.filter(b=>b.code!==active.url); renderBookmarks(); updateBookmarkStar(); return; }
  bookmarkNameInput.value=active.iframe.contentDocument?.title||"New Bookmark";
  bookmarkCodeInput.value=active.url;
  openBookmarkModal();
}

function openBookmarkModal(idx=null){ 
  bookmarkModal.style.display="flex"; 
  if(idx!==null){ bookmarkModal.dataset.editIndex=idx; bookmarkNameInput.value=bookmarks[idx].name; bookmarkCodeInput.value=bookmarks[idx].code;}
  else delete bookmarkModal.dataset.editIndex;
}
function saveBookmark(){
  const name=bookmarkNameInput.value.trim(); const code=bookmarkCodeInput.value.trim();
  if(!name||!code)return;
  const editIndex=bookmarkModal.dataset.editIndex;
  if(editIndex!==undefined){ bookmarks[editIndex]={name,code}; delete bookmarkModal.dataset.editIndex; }
  else bookmarks.push({name,code});
  bookmarkModal.style.display="none"; renderBookmarks(); updateBookmarkStar();
}
function closeBookmarkModal(){bookmarkModal.style.display="none";}

function updateBookmarkStar(){
  if(!active){ bookmarkStar.textContent="☆"; return; }
  const found=bookmarks.find(b=>b.code===active.url);
  bookmarkStar.textContent=found?"★":"☆";
}
</script>
</body>
</html>
