<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub</title>

<!-- ============ UV PROXY ============ -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
}
</script>

<style>
:root{
  --bg:#050505;
  --panel:#0f0f0f;
  --bar:#111;
  --tab:#1a1a1a;
  --active:#111;
  --border:#2a2a2a;
  --text:#e0e0e0;
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* ===== HEADER / HOME ===== */
header{
  background:var(--panel);
  padding:16px;
  text-align:center;
  font-size:2rem;
  font-weight:700;
  border-bottom:1px solid var(--border);
}
nav{
  display:flex;
  justify-content:center;
  gap:18px;
  padding:10px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
.nav-btn{
  padding:10px 18px;
  background:#141414;
  border-radius:14px;
  cursor:pointer;
}
main{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}
#homeSearch{
  width:600px;
  padding:16px;
  background:#111;
  border:1px solid var(--border);
  color:#fff;
  border-radius:999px;
}

/* ===== PROXY OVERLAY ===== */
#proxyOverlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:none;
  flex-direction:column;
  z-index:9999;
}

/* ===== TAB BAR (CONNECTED) ===== */
#tabsBar{
  display:flex;
  align-items:flex-end;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
.tab{
  display:flex;
  align-items:center;
  gap:6px;
  padding:8px 12px;
  background:var(--tab);
  border-right:1px solid var(--border);
  max-width:2in;
  min-width:100px;
  cursor:pointer;
}
.tab.active{
  background:var(--active);
  border-bottom:1px solid var(--active);
}
.tab img{width:14px;height:14px}
.tab span{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  font-size:.85rem;
}
.tab .close{
  margin-left:auto;
  color:#fff;
  cursor:pointer;
}
#newTabBtn{
  padding:8px 14px;
  cursor:pointer;
}

/* ===== CLOSE OVERLAY (SAME LEVEL AS TABS) ===== */
#closeProxy{
  margin-left:auto;
  padding:8px 14px;
  cursor:pointer;
  color:#fff;
}

/* ===== BROWSER BAR ===== */
#browserBar{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px;
  background:var(--bar);
}
.btn{
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
#urlWrap{
  flex:1;
  display:flex;
  align-items:center;
  background:#000;
  border:1px solid #fff;
  border-radius:999px;
}
#urlBar{
  flex:1;
  padding:8px 14px;
  background:none;
  border:none;
  color:#fff;
  outline:none;
}
#star{
  padding:0 12px;
  cursor:pointer;
  font-size:18px;
}

/* ===== BOOKMARK BAR (ALWAYS VISIBLE) ===== */
#bookmarkBar{
  background:#000;
  border-bottom:1px solid var(--border);
  padding:10px;
  display:flex;
  gap:14px;
  min-height:38px;
}
.bookmark{
  font-size:.8rem;
  cursor:pointer;
}
.bookmark[contenteditable]{outline:1px dashed #555}

/* ===== BOOKMARK PANEL ===== */
#bookmarkPanel{
  position:absolute;
  top:120px;
  left:50%;
  transform:translateX(-50%);
  width:420px;
  background:#111;
  border:1px solid var(--border);
  padding:16px;
  display:none;
  z-index:20;
}
#bookmarkPanel input{
  width:100%;
  padding:8px;
  margin-bottom:10px;
  background:#000;
  border:1px solid var(--border);
  color:#fff;
}
#bookmarkPanel button{
  padding:8px 14px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  cursor:pointer;
}

/* ===== FRAMES ===== */
#frames{flex:1;position:relative}
.proxyFrame{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
}
.proxyFrame.active{display:block}
</style>
</head>

<body>

<header>Glitch Hub</header>
<nav>
  <div class="nav-btn" onclick="location.href='../games/index.html'">Games</div>
  <div class="nav-btn" onclick="location.href='../movies/index.html'">Movies</div>
  <div class="nav-btn" onclick="location.href='../ai/index.html'">AI</div>
  <div class="nav-btn" onclick="location.href='../tools/index.html'">Tools</div>
</nav>

<main>
  <input id="homeSearch" placeholder="Search or enter URL">
</main>

<!-- ===== PROXY ===== -->
<div id="proxyOverlay">

  <div id="tabsBar">
    <div id="newTabBtn">＋</div>
    <div id="closeProxy">✕</div>
  </div>

  <div id="browserBar">
    <button class="btn" onclick="goBack()">⟵</button>
    <button class="btn" onclick="goForward()">⟶</button>
    <button class="btn" onclick="reloadTab()">⟳</button>

    <div id="urlWrap">
      <input id="urlBar">
      <div id="star">☆</div>
    </div>

    <button class="btn" onclick="injectDev()">&lt;/&gt;</button>
    <button class="btn" onclick="toggleFS()">⛶</button>
  </div>

  <div id="bookmarkBar"></div>
  <div id="frames"></div>

  <div id="bookmarkPanel">
    <input id="bmName" placeholder="Bookmark name">
    <input id="bmUrl" placeholder="URL or javascript:">
    <button onclick="saveBookmark()">Save</button>
  </div>

</div>

<script>
const overlay=document.getElementById("proxyOverlay");
const frames=document.getElementById("frames");
const tabsBar=document.getElementById("tabsBar");
const urlBar=document.getElementById("urlBar");
const star=document.getElementById("star");
const bookmarkBar=document.getElementById("bookmarkBar");
const bookmarkPanel=document.getElementById("bookmarkPanel");

let tabs=[],active=null;
let bookmarks=JSON.parse(localStorage.getItem("bookmarks")||"{}");

/* ===== URL ===== */
function normalize(input){
  if(input.startsWith("javascript:")) return input;
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

/* ===== TABS ===== */
function newTab(url=""){
  const iframe=document.createElement("iframe");
  iframe.className="proxyFrame";
  frames.appendChild(iframe);

  const tab=document.createElement("div");
  tab.className="tab";
  const icon=document.createElement("img");
  const title=document.createElement("span");
  title.textContent="New Tab";
  const close=document.createElement("span");
  close.textContent="✕";
  close.className="close";

  tab.append(icon,title,close);
  tabsBar.insertBefore(tab,document.getElementById("newTabBtn"));

  const obj={iframe,tab,title,icon,url:""};
  tabs.push(obj);

  tab.onclick=()=>activate(obj);
  close.onclick=e=>{
    e.stopPropagation();
    frames.removeChild(iframe);
    tabsBar.removeChild(tab);
    tabs=tabs.filter(t=>t!==obj);
    if(tabs[0]) activate(tabs[0]);
  };

  iframe.onload=()=>{
    try{
      const d=iframe.contentDocument;
      title.textContent=d.title||"Tab";
      const f=d.querySelector("link[rel~='icon']");
      if(f) icon.src=f.href;
    }catch{}
  };

  activate(obj);
  if(url) navigate(obj,url);
}

function activate(t){
  tabs.forEach(x=>{
    x.iframe.classList.remove("active");
    x.tab.classList.remove("active");
  });
  active=t;
  t.iframe.classList.add("active");
  t.tab.classList.add("active");
  urlBar.value=t.url||"";
  updateStar();
}

function navigate(t,raw){
  const url=normalize(raw);
  t.url=url;
  if(url.startsWith("javascript:")){
    t.iframe.contentWindow.eval(url.slice(11));
    return;
  }
  t.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);
}

/* ===== BOOKMARKS ===== */
function renderBookmarks(){
  bookmarkBar.innerHTML="";
  for(const url in bookmarks){
    const b=document.createElement("div");
    b.className="bookmark";
    b.textContent=bookmarks[url];
    b.onclick=()=>navigate(active,url);
    b.ondblclick=()=>{
      b.contentEditable=true;
      b.focus();
    };
    b.onblur=()=>{
      b.contentEditable=false;
      bookmarks[url]=b.textContent.trim();
      localStorage.setItem("bookmarks",JSON.stringify(bookmarks));
    };
    bookmarkBar.appendChild(b);
  }
}

function updateStar(){
  star.textContent=active&&bookmarks[active.url]?"★":"☆";
}

star.onclick=()=>{
  if(!active) return;
  if(bookmarks[active.url]){
    delete bookmarks[active.url];
  }else{
    document.getElementById("bmName").value=active.url;
    document.getElementById("bmUrl").value=active.url;
    bookmarkPanel.style.display="block";
    return;
  }
  localStorage.setItem("bookmarks",JSON.stringify(bookmarks));
  renderBookmarks();
  updateStar();
};

function saveBookmark(){
  const name=document.getElementById("bmName").value.trim();
  const url=document.getElementById("bmUrl").value.trim();
  if(!name||!url) return;
  bookmarks[url]=name;
  localStorage.setItem("bookmarks",JSON.stringify(bookmarks));
  bookmarkPanel.style.display="none";
  renderBookmarks();
  updateStar();
}

/* ===== CONTROLS ===== */
function goBack(){active?.iframe.contentWindow.history.back()}
function goForward(){active?.iframe.contentWindow.history.forward()}
function reloadTab(){active?.iframe.contentWindow.location.reload()}
function toggleFS(){document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen()}
function injectDev(){
  active?.iframe.contentWindow.eval(`(function(){
    var s=document.createElement('script');
    s.src='//cdn.jsdelivr.net/npm/eruda';
    document.body.appendChild(s);
    s.onload=()=>eruda.init();
  })()`);
}
document.getElementById("closeProxy").onclick=()=>{
  overlay.style.display="none";
};
document.getElementById("newTabBtn").onclick=()=>newTab();
document.getElementById("homeSearch").onkeydown=e=>{
  if(e.key==="Enter"){
    overlay.style.display="flex";
    newTab(e.target.value);
  }
};
urlBar.onkeydown=e=>{
  if(e.key==="Enter"&&active) navigate(active,urlBar.value);
};

/* ===== LIVE DECODE ===== */
setInterval(()=>{
  if(!active) return;
  try{
    const h=active.iframe.contentWindow.location.href;
    if(h.includes(__uv$config.prefix)){
      const enc=h.split(__uv$config.prefix)[1];
      const dec=__uv$config.decodeUrl(enc.replace(/^\/+/,""));
      active.url=dec;
      if(document.activeElement!==urlBar) urlBar.value=dec;
      updateStar();
    }
  }catch{}
},400);

renderBookmarks();
</script>
</body>
</html>
