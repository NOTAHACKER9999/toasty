<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub</title>

<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
}
</script>

<style>
:root{
  --bg:#0a0a0a;
  --panel:#121212;
  --bar:#0e0e0e;
  --tab:#1a1a1a;
  --tab-active:#121212;
  --text:#ffffff;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

header{
  background:var(--panel);
  padding:14px;
  text-align:center;
  font-size:2rem;
  font-weight:700;
}

nav{
  display:flex;
  justify-content:center;
  gap:18px;
  padding:10px;
  background:var(--panel);
}

.nav-btn{
  padding:10px 18px;
  background:#111;
  border-radius:8px;
  cursor:pointer;
}
.nav-btn:hover{background:#222}

/* HOME */
#home{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  pointer-events:auto;
}
#homeSearch{
  width:420px;
  max-width:90%;
  padding:14px 18px;
  background:#111;
  border:none;
  border-radius:999px;
  color:white;
  font-size:1.1rem;
  outline:none;
  pointer-events:auto;
}

/* OVERLAY */
#proxyOverlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:none;
  flex-direction:column;
  z-index:900;
}

/* TABS */
#tabsBar{
  display:flex;
  align-items:flex-end;
  background:var(--panel);
  padding:4px;
}
.tab{
  display:flex;
  align-items:center;
  gap:6px;
  padding:8px 26px 8px 10px;
  background:var(--tab);
  border-radius:8px 8px 0 0;
  cursor:pointer;
  max-width:180px;
}
.tab.active{background:var(--tab-active)}
.tab img{width:16px;height:16px}
.tab span{
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}
.tab .close{
  position:absolute;
  right:6px;
  cursor:pointer;
}

#newTabBtn{
  padding:8px 14px;
  background:#111;
  border-radius:8px;
  cursor:pointer;
  margin-left:4px;
}

#browserBar{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px;
  background:var(--bar);
}

.ctrl{
  padding:6px 10px;
  background:#111;
  border:none;
  color:white;
  cursor:pointer;
}
.ctrl:hover{background:#222}

#urlWrap{flex:1;position:relative}
#urlBar{
  width:100%;
  padding:6px 36px 6px 10px;
  background:black;
  border:none;
  color:white;
  outline:none;
}

#bookmarkStar{
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  font-size:20px;
}

#threeDots{
  font-size:20px;
  padding:6px 10px;
  cursor:pointer;
}

/* 3 DOT MENU */
#menu{
  position:absolute;
  top:92px;
  right:10px;
  background:#111;
  border-radius:10px;
  display:none;
  flex-direction:column;
  min-width:180px;
  z-index:9999;
}
.menuItem{
  padding:10px;
  cursor:pointer;
}
.menuItem:hover{background:#222}

/* BOOKMARK BAR */
#bookmarkBar{
  display:flex;
  gap:6px;
  padding:6px;
  background:var(--panel);
  overflow-x:auto;
}
.bookmarkButton{
  padding:6px 10px;
  background:#111;
  border-radius:6px;
  cursor:pointer;
}

/* FRAMES */
#frames{flex:1;position:relative}
iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
}
iframe.active{display:block}

/* PANEL OVERLAY */
.panelOverlay{
  position:absolute;
  inset:0;
  background:#0a0a0a;
  z-index:50;
  display:none;
  flex-direction:column;
}
.panelHeader{
  padding:12px;
  font-size:1.3rem;
  background:#111;
  display:flex;
  justify-content:space-between;
}
.panelContent{
  padding:20px;
  overflow:auto;
  flex:1;
}

</style>
</head>

<body>

<header>Glitch Hub</header>

<nav>
  <div class="nav-btn">Games</div>
  <div class="nav-btn">Movies</div>
  <div class="nav-btn">AI</div>
  <div class="nav-btn">Tools</div>
</nav>

<div id="home">
  <input id="homeSearch" placeholder="Search or enter URL" autofocus>
</div>

<div id="proxyOverlay">

  <div id="tabsBar">
    <div id="newTabBtn">＋</div>
  </div>

  <div id="browserBar">
    <button class="ctrl" onclick="goBack()">⟵</button>
    <button class="ctrl" onclick="goForward()">⟶</button>
    <button class="ctrl" onclick="reloadTab()">⟳</button>

    <div id="urlWrap">
      <input id="urlBar">
      <span id="bookmarkStar">☆</span>
    </div>

    <div id="threeDots">⋮</div>
  </div>

  <div id="bookmarkBar"></div>
  <div id="frames"></div>

  <!-- PANELS -->
  <div id="historyPanel" class="panelOverlay">
    <div class="panelHeader">
      History
      <button onclick="closePanel()">✕</button>
    </div>
    <div class="panelContent" id="historyList"></div>
  </div>

  <div id="bookmarksPanel" class="panelOverlay">
    <div class="panelHeader">
      Bookmarks
      <button onclick="closePanel()">✕</button>
    </div>
    <div class="panelContent" id="bookmarksList"></div>
  </div>

  <div id="settingsPanel" class="panelOverlay">
    <div class="panelHeader">
      Settings
      <button onclick="closePanel()">✕</button>
    </div>
    <div class="panelContent">
      <p>Settings panel ready.</p>
    </div>
  </div>

</div>

<!-- 3 DOT MENU -->
<div id="menu">
  <div class="menuItem" onclick="newTab()">New Tab</div>
  <div class="menuItem" onclick="openHistory()">History</div>
  <div class="menuItem" onclick="openBookmarks()">Bookmarks</div>
  <div class="menuItem" onclick="injectDev()">Dev Tools</div>
  <div class="menuItem" onclick="openSettings()">Settings</div>
</div>

<script>
const home=document.getElementById("home");
const overlay=document.getElementById("proxyOverlay");
const homeSearch=document.getElementById("homeSearch");
const frames=document.getElementById("frames");
const tabsBar=document.getElementById("tabsBar");
const urlBar=document.getElementById("urlBar");
const menu=document.getElementById("menu");

let tabs=[],active=null;
let history=[];

/* HOME */
homeSearch.onkeydown=e=>{
  if(e.key==="Enter") newTab(homeSearch.value);
};

/* NORMALIZE */
function normalize(v){
  if(!v.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(v);
  if(!v.startsWith("http")) return "https://"+v;
  return v;
}

/* TABS */
function newTab(url="https://www.startpage.com"){
  home.style.display="none";
  overlay.style.display="flex";

  const iframe=document.createElement("iframe");
  const tab=document.createElement("div");
  tab.className="tab";
  tab.innerHTML=`<img><span>New Tab</span><div class="close">✕</div>`;

  tabsBar.insertBefore(tab,document.getElementById("newTabBtn"));
  frames.appendChild(iframe);

  const obj={iframe,tab,url};
  tabs.push(obj);

  tab.onclick=()=>activate(obj);
  tab.querySelector(".close").onclick=e=>{
    e.stopPropagation();
    tab.remove();
    iframe.remove();
  };

  iframe.src=__uv$config.prefix+__uv$config.encodeUrl(normalize(url));

  iframe.onload=()=>{
    try{
      tab.querySelector("span").textContent=iframe.contentDocument.title;
      const ico=iframe.contentDocument.querySelector("link[rel~='icon']");
      if(ico) tab.querySelector("img").src=ico.href;
    }catch{}
  };

  activate(obj);
}

function activate(t){
  tabs.forEach(x=>{
    x.tab.classList.remove("active");
    x.iframe.classList.remove("active");
  });
  active=t;
  t.tab.classList.add("active");
  t.iframe.classList.add("active");
}

/* URL BAR AUTO UPDATE */
let editing=false;
urlBar.oninput=()=>editing=true;
urlBar.onblur=()=>editing=false;

setInterval(()=>{
  if(active && !editing){
    try{
      const enc=active.iframe.contentWindow.location.href.split(__uv$config.prefix)[1];
      active.url=__uv$config.decodeUrl(enc.replace(/^\/+/,""));
      urlBar.value=active.url;

      history.push({
        url:active.url,
        time:new Date().toLocaleString()
      });
    }catch{}
  }
},800);

/* NAV */
urlBar.onkeydown=e=>{
  if(e.key==="Enter"){
    active.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(normalize(urlBar.value));
  }
};

function goBack(){active?.iframe.contentWindow.history.back()}
function goForward(){active?.iframe.contentWindow.history.forward()}
function reloadTab(){active?.iframe.contentWindow.location.reload()}

/* MENU */
threeDots.onclick=()=>{
  menu.style.display=menu.style.display==="flex"?"none":"flex";
};
menu.onmouseleave=()=>menu.style.display="none";

/* PANELS */
function closePanel(){
  document.querySelectorAll(".panelOverlay").forEach(p=>p.style.display="none");
}
function openHistory(){
  const list=document.getElementById("historyList");
  list.innerHTML=history.map(h=>`<div>${h.time} — ${h.url}</div>`).join("");
  document.getElementById("historyPanel").style.display="flex";
}
function openBookmarks(){
  document.getElementById("bookmarksPanel").style.display="flex";
}
function openSettings(){
  document.getElementById("settingsPanel").style.display="flex";
}

/* DEV TOOLS */
function injectDev(){
  try{
    active.iframe.contentWindow.eval(`
      var s=document.createElement('script');
      s.src='//cdn.jsdelivr.net/npm/eruda';
      document.body.appendChild(s);
      s.onload=()=>eruda.init();
    `);
  }catch{}
}
</script>

</body>
</html>
