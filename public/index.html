<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub</title>

<!-- UV -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/uv/sw.js", {
      scope: __uv$config.prefix
    });
  });
}
</script>

<style>
:root{
  --bg:#0a0a0a;
  --panel:#121212;
  --panel2:#0e0e0e;
  --border:#333;
  --text:#fff;
  --btn:#111;
  --btnHover:#222;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== HOME ===== */
header{
  background:var(--panel);
  padding:16px;
  text-align:center;
  font-size:2rem;
  font-weight:700;
  border-bottom:1px solid var(--border);
}
nav{
  display:flex;
  justify-content:center;
  gap:16px;
  padding:12px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
.nav-btn{
  padding:10px 18px;
  background:var(--btn);
  border:1px solid var(--border);
  border-radius:8px;
  cursor:pointer;
}
.nav-btn:hover{background:var(--btnHover)}
#home{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
}
#home input{
  width:70%;
  max-width:600px;
  padding:16px 20px;
  background:#000;
  border:1px solid #fff;
  border-radius:999px;
  color:#fff;
  font-size:1.1rem;
  outline:none;
}

/* ===== PROXY OVERLAY ===== */
#overlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:none;
  flex-direction:column;
  z-index:9999;
}

/* Tabs */
#tabs{
  display:flex;
  align-items:flex-end;
  background:var(--panel);
  padding:4px;
  border-bottom:1px solid var(--border);
  overflow-x:auto;
}
.tab{
  background:var(--btn);
  padding:8px 14px;
  border-top-left-radius:6px;
  border-top-right-radius:6px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  margin-right:-2px;
  border:1px solid var(--border);
}
.tab.active{
  background:var(--bg);
  border-bottom:1px solid var(--bg);
}
.tab img{width:16px;height:16px}
.tab .x{font-weight:bold;cursor:pointer}

/* Browser bar */
#bar{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px;
  background:var(--panel2);
  border-bottom:1px solid var(--border);
}
.btn{
  padding:6px 12px;
  background:var(--btn);
  border:1px solid #fff;
  color:#fff;
  cursor:pointer;
}
.btn:hover{background:var(--btnHover)}
#url{
  flex:1;
  background:#000;
  border:1px solid #fff;
  color:#fff;
  padding:6px 10px;
  font-family:monospace;
  outline:none;
}
#star{margin-left:auto}

/* Bookmarks */
#bookmarks{
  display:flex;
  gap:6px;
  padding:6px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
}
.bookmark{
  padding:4px 10px;
  background:var(--btn);
  border:1px solid var(--border);
  cursor:pointer;
  font-size:.85rem;
}

/* Frames */
#frames{flex:1;position:relative}
iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
}
iframe.active{display:block}

/* Bookmark modal */
#bmModal{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:var(--panel);
  border:1px solid var(--border);
  padding:20px;
  border-radius:10px;
  display:none;
  flex-direction:column;
  gap:10px;
  z-index:10000;
}
#bmModal input{
  padding:8px;
  background:#000;
  border:1px solid var(--border);
  color:#fff;
}
#bmModal button{
  padding:8px;
  background:var(--btn);
  border:1px solid var(--border);
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<header>Glitch Hub</header>

<nav>
  <div class="nav-btn" onclick="location.href='../games/app.html'">Games</div>
  <div class="nav-btn" onclick="location.href='../movies/index.html'">Movies</div>
  <div class="nav-btn" onclick="location.href='../ai/index.html'">AI</div>
  <div class="nav-btn" onclick="location.href='../tools/index.html'">Tools</div>
</nav>

<div id="home">
  <input id="homeSearch" placeholder="Search or enter URL">
</div>

<div id="overlay">
  <div id="tabs"><div class="tab" onclick="newTab()">＋</div></div>

  <div id="bar">
    <div class="btn" onclick="active?.iframe.contentWindow.history.back()">⟵</div>
    <div class="btn" onclick="active?.iframe.contentWindow.history.forward()">⟶</div>
    <div class="btn" onclick="active?.iframe.contentWindow.location.reload()">⟳</div>
    <input id="url">
    <div class="btn" onclick="injectDev()">&lt;/&gt;</div>
    <div class="btn" id="star" onclick="openBookmark()">★</div>
    <div class="btn" onclick="closeOverlay()">✕</div>
  </div>

  <div id="bookmarks"></div>
  <div id="frames"></div>
</div>

<div id="bmModal">
  <input id="bmName" placeholder="Bookmark name">
  <input id="bmUrl" placeholder="URL or javascript:...">
  <div style="display:flex;gap:8px;justify-content:flex-end">
    <button onclick="saveBookmark()">Save</button>
    <button onclick="bmModal.style.display='none'">Cancel</button>
  </div>
</div>

<script>
const overlay=document.getElementById("overlay");
const home=document.getElementById("home");
const tabsEl=document.getElementById("tabs");
const frames=document.getElementById("frames");
const urlBar=document.getElementById("url");
const bookmarks=document.getElementById("bookmarks");
const bmModal=document.getElementById("bmModal");
const bmName=document.getElementById("bmName");
const bmUrl=document.getElementById("bmUrl");

let tabs=[],active=null;

function normalize(v){
  if(!v.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(v);
  if(!v.startsWith("http")) return "https://"+v;
  return v;
}

function newTab(url="https://www.startpage.com"){
  home.style.display="none";
  overlay.style.display="flex";

  const iframe=document.createElement("iframe");
  iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);

  const tab=document.createElement("div");
  tab.className="tab";
  const icon=document.createElement("img");
  const title=document.createElement("span");
  title.textContent="New Tab";
  const x=document.createElement("span");
  x.textContent="✕"; x.className="x";

  tab.append(icon,title,x);
  tabsEl.insertBefore(tab,tabsEl.lastElementChild);
  frames.appendChild(iframe);

  const obj={iframe,tab,url};
  tabs.push(obj);

  tab.onclick=()=>activate(obj);
  x.onclick=e=>{e.stopPropagation();closeTab(obj)};

  iframe.onload=()=>{
    try{
      title.textContent=iframe.contentWindow.document.title;
      const ico=iframe.contentWindow.document.querySelector("link[rel~='icon']");
      if(ico) icon.src=ico.href;
    }catch{}
  };

  activate(obj);
}

function activate(t){
  tabs.forEach(x=>{x.iframe.classList.remove("active");x.tab.classList.remove("active")});
  active=t;
  t.iframe.classList.add("active");
  t.tab.classList.add("active");
  updateUrl();
}

function updateUrl(){
  if(!active) return;
  try{
    const href=active.iframe.contentWindow.location.href;
    const enc=href.split(__uv$config.prefix)[1];
    urlBar.value=__uv$config.decodeUrl(enc.replace(/^\/+/,''));
  }catch{}
  requestAnimationFrame(updateUrl);
}

function closeTab(t){
  t.iframe.remove();t.tab.remove();
  tabs=tabs.filter(x=>x!==t);
  if(tabs.length) activate(tabs[tabs.length-1]);
  else closeOverlay();
}

function closeOverlay(){
  overlay.style.display="none";
  home.style.display="flex";
  tabs.forEach(t=>{t.iframe.remove();t.tab.remove()});
  tabs=[];active=null;
}

document.getElementById("homeSearch").onkeydown=e=>{
  if(e.key==="Enter") newTab(normalize(e.target.value));
};

urlBar.onkeydown=e=>{
  if(e.key==="Enter"&&active){
    active.url=normalize(urlBar.value);
    active.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(active.url);
  }
};

function injectDev(){
  active?.iframe.contentWindow.eval(`
    var s=document.createElement('script');
    s.src='//cdn.jsdelivr.net/npm/eruda';
    document.body.appendChild(s);
    s.onload=()=>eruda.init();
  `);
}

function openBookmark(){
  if(!active) return;
  bmModal.style.display="flex";
  bmName.value=active.iframe.contentWindow.document.title||"Bookmark";
  bmUrl.value=urlBar.value;
}

function saveBookmark(){
  const btn=document.createElement("div");
  btn.className="bookmark";
  btn.textContent=bmName.value;
  btn.onclick=()=>{
    if(bmUrl.value.startsWith("javascript:")){
      active.iframe.contentWindow.eval(bmUrl.value.slice(11));
    }else{
      newTab(bmUrl.value);
    }
  };
  bookmarks.appendChild(btn);
  bmModal.style.display="none";
}
</script>
</body>
</html>
