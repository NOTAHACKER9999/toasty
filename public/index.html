<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub Proxy Browser</title>

<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
  });
}
</script>

<style>
:root{
  --bg:#0a0a0a; --panel:#121212; --border:#333; --accent:#fff; --text:#fff;
  --urlbar-bg:#000; --btn-bg:#111; --btn-hover:#222; --active-tab:#121212;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{background:var(--panel);padding:16px;text-align:center;font-size:2rem;font-weight:700;border-bottom:1px solid var(--border);}
nav{display:flex;justify-content:center;gap:18px;padding:12px;background:var(--panel);border-bottom:1px solid var(--border);}
.nav-btn{padding:10px 20px;background:var(--btn-bg);border:none;border-radius:8px;cursor:pointer;color:var(--text);transition:.3s;}
.nav-btn:hover{background:var(--btn-hover);}
#homeContent{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;gap:20px;}
#homeContent input{width:400px;max-width:90%;padding:14px 20px;border-radius:999px;background:var(--btn-bg);border:none;color:var(--text);font-size:1.1rem;outline:none;}

/* ===== PROXY OVERLAY ===== */
#proxyOverlay{position:fixed;inset:0;background:var(--bg);display:none;flex-direction:column;z-index:9999;}
#tabsBar{display:flex;align-items:flex-end;gap:2px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);overflow:hidden;position:relative;}
.tab{position:relative;flex-shrink:0;max-width:192px;min-width:80px;padding:8px 8px;background:var(--btn-bg);color:var(--text);border-top-left-radius:6px;border-top-right-radius:6px;cursor:pointer;display:flex;align-items:center;gap:6px;justify-content:flex-start;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:.2s;}
.tab.active{background:var(--active-tab);}
.tab img{width:16px;height:16px;vertical-align:middle;}
.tab .close{margin-left:auto;font-weight:900;cursor:pointer;color:#ff5555;}
#newTabBtn{flex-shrink:0;padding:0 12px;background:var(--btn-bg);border-radius:6px;cursor:pointer;color:var(--text);display:flex;align-items:center;justify-content:center;font-weight:700;transition:.2s;}
#newTabBtn:hover{background:var(--btn-hover);}

/* ===== BROWSER BAR ===== */
#browserBar{display:flex;align-items:center;gap:6px;padding:6px;background:var(--btn-bg);border-bottom:1px solid var(--border);}
.bubble-btn{padding:6px 12px;border-radius:4px;background:var(--btn-bg);border:none;cursor:pointer;color:var(--text);}
.bubble-btn:hover{background:var(--btn-hover);}
#urlBar{flex:1;padding:6px 12px;background:var(--urlbar-bg);border-radius:4px;color:var(--text);outline:none;font-family:monospace;font-size:0.9rem;}
#bookmarkStar{padding:6px 12px;margin-left:4px;border-radius:4px;background:var(--btn-bg);border:none;cursor:pointer;color:var(--text);}
#bookmarkBar{display:flex;gap:4px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);overflow-x:auto;}
.bookmark-btn{padding:4px 10px;background:var(--btn-bg);color:var(--text);border:none;border-radius:4px;cursor:pointer;font-size:0.85rem;}
.bookmark-btn:hover{background:var(--btn-hover);}
#frames{flex:1;position:relative;}
.proxyFrame{position:absolute;inset:0;width:100%;height:100%;border:none;display:none;}
.proxyFrame.active{display:block;}
#bookmarkModal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border:1px solid var(--border);padding:20px;border-radius:8px;display:none;flex-direction:column;gap:10px;z-index:10000;}
#bookmarkModal input{padding:6px;border-radius:4px;background:var(--btn-bg);border:none;color:var(--text);}
#bookmarkModal button{padding:6px 12px;background:var(--btn-bg);border:none;border-radius:4px;color:var(--text);cursor:pointer;}
#bookmarkModal button:hover{background:var(--btn-hover);}
</style>
</head>
<body>

<header>Glitch Hub</header>

<nav>
  <div class="nav-btn" onclick="window.location.href='../games/app.html'">Games</div>
  <div class="nav-btn" onclick="window.location.href='../movies/index.html'">Movies</div>
  <div class="nav-btn" onclick="window.location.href='../ai/index.html'">AI</div>
  <div class="nav-btn" onclick="window.location.href='../tools/index.html'">Tools</div>
</nav>

<div id="homeContent">
  <input id="homeSearch" placeholder="Search or enter a URL (press Enter)">
</div>

<div id="proxyOverlay">
  <div id="tabsBar">
    <!-- Tabs inserted dynamically here -->
    <div id="newTabBtn" onclick="newTab()">＋</div>
  </div>

  <div id="browserBar">
    <div class="bubble-btn" onclick="goBack()">⟵</div>
    <div class="bubble-btn" onclick="goForward()">⟶</div>
    <div class="bubble-btn" onclick="refreshTab()">⟳</div>
    <input id="urlBar" spellcheck="false">
    <div class="bubble-btn" onclick="fullscreenTab()">⛶</div>
    <div class="bubble-btn" onclick="injectCode()">&lt;/&gt;</div>
    <div id="bookmarkStar" onclick="suggestBookmark()">★</div>
  </div>

  <div id="bookmarkBar"></div>
  <div id="frames"></div>
</div>

<div id="bookmarkModal">
  <input type="text" id="bookmarkName" placeholder="Bookmark Name">
  <input type="text" id="bookmarkCode" placeholder="Bookmarklet JS Code or URL">
  <div style="display:flex;gap:10px;justify-content:flex-end;">
    <button onclick="saveBookmark()">Save</button>
    <button onclick="closeBookmarkModal()">Cancel</button>
  </div>
</div>

<script>
const homeSearch = document.getElementById("homeSearch");
const overlay = document.getElementById("proxyOverlay");
const tabsBar = document.getElementById("tabsBar");
const frames = document.getElementById("frames");
const urlBar = document.getElementById("urlBar");
const bookmarkBar = document.getElementById("bookmarkBar");
const homeContent = document.getElementById("homeContent");
const bookmarkModal = document.getElementById("bookmarkModal");
const bookmarkNameInput = document.getElementById("bookmarkName");
const bookmarkCodeInput = document.getElementById("bookmarkCode");

let tabs = [], active = null;

function normalize(input){
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

homeSearch.addEventListener("keydown", e=>{
  if(e.key==="Enter") newTab(normalize(homeSearch.value.trim()));
});

function newTab(url="https://www.startpage.com"){
  homeContent.style.display="none";
  const iframe = document.createElement("iframe");
  iframe.className="proxyFrame";

  const tab = document.createElement("div");
  tab.className="tab";
  const title = document.createElement("span"); title.textContent="New Tab";
  const favicon = document.createElement("img"); favicon.src="";
  const close = document.createElement("span"); close.textContent="✕"; close.className="close";
  const tabObj = {iframe, tab, title, url, favicon};
  close.onclick = e=>{e.stopPropagation(); closeTab(tabObj);};
  tab.onclick = ()=>activate(tabObj);
  tab.append(favicon, title, close);
  tabs.splice(tabs.length,0,tabObj);
  tabsBar.insertBefore(tab, document.getElementById("newTabBtn"));
  frames.appendChild(iframe);

  iframe.src = __uv$config.prefix + __uv$config.encodeUrl(url);
  overlay.style.display="flex";
  activate(tabObj);

  iframe.onload = () => {
    try{
      const w = iframe.contentWindow;
      tabObj.title.textContent = w.document.title || "New Tab";
      const linkIcon = w.document.querySelector("link[rel~='icon']");
      if(linkIcon) tabObj.favicon.src = linkIcon.href;
      resizeTabs();
    } catch{}
  };
}

function resizeTabs(){
  const availableWidth = tabsBar.clientWidth - 60; // space for new tab
  const tabWidth = Math.min(192, Math.max(50, availableWidth / Math.max(tabs.length,1)));
  tabs.forEach(t=>t.tab.style.width = tabWidth + "px");
}

window.addEventListener("resize", resizeTabs);

function activate(t){
  tabs.forEach(x=>{x.iframe.classList.remove("active"); x.tab.classList.remove("active");});
  active = t;
  t.iframe.classList.add("active");
  t.tab.classList.add("active");
  t.tab.style.backgroundColor = "var(--active-tab)";
  updateUrlBar();
}

function updateUrlBar(){
  if(!active) return;
  try{
    const w = active.iframe.contentWindow;
    let href = active.url;
    if(w.location.href.includes(__uv$config.prefix)){
      const encoded = w.location.href.split(__uv$config.prefix)[1];
      href = __uv$config.decodeUrl(encoded.replace(/^\/+/,''));
    }
    urlBar.value = href;
  } catch{ urlBar.value = active.url; }
  requestAnimationFrame(updateUrlBar);
}

function closeTab(t){
  const i = tabs.indexOf(t);
  if(i>-1){t.iframe.remove(); t.tab.remove(); tabs.splice(i,1); activate(tabs[i-1]||tabs[0]||null);}
  if(tabs.length===0){overlay.style.display="none"; homeContent.style.display="flex";}
  resizeTabs();
}

function goBack(){active?.iframe.contentWindow.history.back();}
function goForward(){active?.iframe.contentWindow.history.forward();}
function refreshTab(){active?.iframe.contentWindow.location.reload();}
function fullscreenTab(){active?.iframe.requestFullscreen?.();}
function injectCode(){
  if(!active) return;
  const code=`javascript:(function () {
    var script=document.createElement('script');
    script.src="//cdn.jsdelivr.net/npm/eruda";
    document.body.appendChild(script);
    script.onload = function(){eruda.init();}
  })();`;
  active.iframe.contentWindow.eval(code);
}

// BOOKMARKS
function suggestBookmark(){
  if(!active) return;
  const w = active.iframe.contentWindow;
  let href = active.url;
  try{if(w.location.href.includes(__uv$config.prefix)){const e=w.location.href.split(__uv$config.prefix)[1]; href=__uv$config.decodeUrl(e.replace(/^\/+/,''));}}catch{}
  bookmarkNameInput.value = w.document.title || "New Bookmark";
  bookmarkCodeInput.value = href;
  bookmarkModal.style.display="flex";
}
function closeBookmarkModal(){bookmarkModal.style.display="none";}
function saveBookmark(){
  const name = bookmarkNameInput.value.trim();
  const code = bookmarkCodeInput.value.trim();
  if(name && code) addBookmark(name, code);
  closeBookmarkModal();
}
function addBookmark(name, code){
  const btn = document.createElement("div");
  btn.className="bookmark-btn"; btn.textContent=name;
  btn.onclick=()=>injectBookmarklet(code);
  bookmarkBar.appendChild(btn);
}
function injectBookmarklet(code){
  if(!active) return;
  active.iframe.contentWindow.eval(code);
}

urlBar.addEventListener("keydown", e=>{
  if(e.key==="Enter" && active){
    active.url = urlBar.value.trim();
    active.iframe.src = __uv$config.prefix + __uv$config.encodeUrl(active.url);
  }
});
</script>
</body>
</html>
