<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Glitch Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Ultraviolet -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
}
</script>

<style>
:root{
  --bg:#0a0a0a;
  --panel:#121212;
  --bar:#0e0e0e;
  --tab:#1a1a1a;
  --tab-active:#222;
  --text:#fff;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  height:100vh;
  font-family:Segoe UI,Arial;
}

/* ================= HOME ================= */
#homePage{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
}

header{
  background:var(--panel);
  padding:14px;
  text-align:center;
  font-size:2rem;
}

nav{
  display:flex;
  justify-content:center;
  gap:14px;
  background:var(--panel);
  padding:10px;
}

.nav-btn{
  padding:10px 18px;
  background:#111;
  border-radius:8px;
  cursor:pointer;
}
.nav-btn:hover{background:#222}

#homeMain{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
}

#homeSearch{
  width:420px;
  max-width:90%;
  padding:14px 18px;
  background:#111;
  border:none;
  border-radius:999px;
  color:white;
  font-size:1.1rem;
  outline:none;
}

/* ================= PROXY OVERLAY ================= */
#proxyOverlay{
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
  background:var(--bg);
  z-index:100;
}

/* ---------- Tabs ---------- */
#tabsBar{
  display:flex;
  align-items:flex-end;
  background:var(--panel);
  padding:4px;
}

.tab{
  display:flex;
  align-items:center;
  gap:6px;
  padding:8px 26px 8px 10px;
  background:var(--tab);
  border-radius:8px 8px 0 0;
  cursor:pointer;
  max-width:200px;
  position:relative;
}
.tab.active{background:var(--tab-active)}
.tab img{width:16px;height:16px}
.tab span{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.tab .close{
  position:absolute;
  right:6px;
  top:4px;
  cursor:pointer;
}

#newTabBtn,#closeProxyBtn{
  padding:8px 12px;
  background:#111;
  border-radius:8px;
  margin-left:6px;
  cursor:pointer;
}

/* ---------- Browser Bar ---------- */
#browserBar{
  position:relative;
  z-index:50;
  display:flex;
  align-items:center;
  gap:6px;
  background:var(--bar);
  padding:6px;
}

.ctrl{
  padding:6px 10px;
  background:#111;
  border:none;
  color:white;
  cursor:pointer;
}
.ctrl:hover{background:#222}

#urlWrap{
  flex:1;
  position:relative;
}
#urlBar{
  width:100%;
  padding:6px 36px 6px 10px;
  background:black;
  border:none;
  color:white;
  font-family:monospace;
}
#bookmarkStar{
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  font-size:22px;
}

/* ---------- 3 DOT MENU ---------- */
#menuWrap{position:relative}
#menu{
  position:absolute;
  top:38px;
  right:0;
  background:#111;
  display:none;
  flex-direction:column;
  min-width:180px;
  z-index:200;
}
#menu button{
  padding:10px;
  background:none;
  border:none;
  color:white;
  text-align:left;
  cursor:pointer;
}
#menu button:hover{background:#222}
#menu .bottom{border-top:1px solid #222}

/* ---------- Bookmark Bar ---------- */
#bookmarkBar{
  background:var(--panel);
  padding:6px;
  display:flex;
  gap:6px;
  overflow-x:auto;
}
.bookmarkBtn{
  padding:6px 10px;
  background:#111;
  border-radius:6px;
  cursor:pointer;
}

/* ---------- Content Area ---------- */
#contentArea{
  flex:1;
  position:relative;
}

/* iframe layer */
iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
  z-index:1;
}
iframe.active{display:block}

/* internal panels */
.internalPanel{
  position:absolute;
  inset:0;
  background:#0b0b0b;
  padding:20px;
  overflow:auto;
  z-index:10;
}

/* ---------- Modals ---------- */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:300;
}
.modalBox{
  background:#111;
  padding:22px;
  border-radius:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.modalBox input{
  padding:10px;
  background:black;
  border:none;
  color:white;
}
.modalBox button{
  padding:8px;
  background:#222;
  border:none;
  color:white;
}
.deleteBtn{background:#660000}
</style>
</head>

<body>

<!-- ================= HOME ================= -->
<div id="homePage">
  <header>Glitch Hub</header>
  <nav>
    <div class="nav-btn" onclick="location.href='../games/app.html'">Games</div>
    <div class="nav-btn" onclick="location.href='../movies/index.html'">Movies</div>
    <div class="nav-btn" onclick="location.href='../ai/index.html'">AI</div>
    <div class="nav-btn" onclick="location.href='../tools/index.html'">Tools</div>
  </nav>
  <div id="homeMain">
    <input id="homeSearch" placeholder="Search or enter URL">
  </div>
</div>

<!-- ================= PROXY ================= -->
<div id="proxyOverlay">

  <div id="tabsBar">
    <div id="newTabBtn">＋</div>
    <div id="closeProxyBtn">✕</div>
  </div>

  <div id="browserBar">
    <button class="ctrl" onclick="goBack()">⟵</button>
    <button class="ctrl" onclick="goForward()">⟶</button>
    <button class="ctrl" onclick="reloadTab()">⟳</button>

    <div id="urlWrap">
      <input id="urlBar">
      <span id="bookmarkStar">☆</span>
    </div>

    <button class="ctrl" onclick="injectDev()">&lt;/&gt;</button>

    <div id="menuWrap">
      <button class="ctrl" onclick="toggleMenu()">⋮</button>
      <div id="menu">
        <button onclick="newTab()">New Tab</button>
        <button onclick="openPanel('History')">History</button>
        <button onclick="openPanel('Bookmarks')">Bookmarks</button>
        <button onclick="injectDev()">Dev Tools</button>
        <button class="bottom" onclick="openPanel('Settings')">Settings</button>
      </div>
    </div>
  </div>

  <div id="bookmarkBar"></div>
  <div id="contentArea"></div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
/* ---------- STATE ---------- */
const homePage = document.getElementById("homePage");
const proxy = document.getElementById("proxyOverlay");
const homeSearch = document.getElementById("homeSearch");
const contentArea = document.getElementById("contentArea");
const urlBar = document.getElementById("urlBar");
const star = document.getElementById("bookmarkStar");
const bookmarkBar = document.getElementById("bookmarkBar");
const menu = document.getElementById("menu");

let tabs=[],active=null;
let bookmarks=JSON.parse(localStorage.bookmarks||"{}");
let historyLog=JSON.parse(localStorage.history||"[]");
let userTyping=false;

/* ---------- HOME ---------- */
homeSearch.onkeydown=e=>{
  if(e.key==="Enter") newTab(normalize(homeSearch.value));
};

/* ---------- UTILS ---------- */
function normalize(v){
  if(!v.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(v);
  if(!v.startsWith("http")) return "https://"+v;
  return v;
}

/* ---------- TABS ---------- */
newTabBtn.onclick=()=>newTab();
closeProxyBtn.onclick=closeProxy;

function newTab(url="https://www.startpage.com"){
  homePage.style.display="none";
  proxy.style.display="flex";

  const iframe=document.createElement("iframe");
  const tab=document.createElement("div");
  tab.className="tab";
  const icon=document.createElement("img");
  const title=document.createElement("span");
  title.textContent="New Tab";
  const close=document.createElement("span");
  close.textContent="✕";
  close.className="close";
  tab.append(icon,title,close);

  tabsBar.insertBefore(tab,newTabBtn);
  contentArea.appendChild(iframe);

  const obj={iframe,tab,url};
  tabs.push(obj);

  close.onclick=e=>{e.stopPropagation();closeTab(obj)};
  tab.onclick=()=>activate(obj);

  iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);
  activate(obj);

  iframe.onload=()=>{
    try{
      title.textContent=iframe.contentDocument.title||url;
      const ico=iframe.contentDocument.querySelector("link[rel~='icon']");
      if(ico) icon.src=ico.href;
    }catch{}
  };
}

function activate(t){
  tabs.forEach(x=>{
    x.tab.classList.remove("active");
    x.iframe.classList.remove("active");
  });
  active=t;
  t.tab.classList.add("active");
  t.iframe.classList.add("active");
}

function closeTab(t){
  t.tab.remove();
  t.iframe.remove();
  tabs=tabs.filter(x=>x!==t);
  if(tabs.length) activate(tabs.at(-1));
  else closeProxy();
}

function closeProxy(){
  proxy.style.display="none";
  homePage.style.display="flex";
  homeSearch.focus();
}

/* ---------- NAV ---------- */
function goBack(){active?.iframe.contentWindow.history.back()}
function goForward(){active?.iframe.contentWindow.history.forward()}
function reloadTab(){active?.iframe.contentWindow.location.reload()}

/* ---------- URL BAR ---------- */
urlBar.oninput=()=>userTyping=true;
urlBar.onblur=()=>userTyping=false;
urlBar.onkeydown=e=>{
  if(e.key==="Enter"&&active){
    active.url=normalize(urlBar.value);
    active.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(active.url);
  }
};

function updateURL(){
  if(active && !userTyping){
    try{
      const enc=active.iframe.contentWindow.location.href.split(__uv$config.prefix)[1];
      active.url=__uv$config.decodeUrl(enc?.replace(/^\/+/,""));
    }catch{}
    urlBar.value=active.url;
    star.textContent=bookmarks[active.url]?"★":"☆";
    logHistory(active.url);
  }
  requestAnimationFrame(updateURL);
}
requestAnimationFrame(updateURL);

/* ---------- HISTORY ---------- */
function logHistory(url){
  if(!url || url.startsWith("/?/")) return;
  if(historyLog[0]?.url===url) return;
  historyLog.unshift({url,time:new Date().toLocaleString()});
  localStorage.history=JSON.stringify(historyLog);
}

/* ---------- INTERNAL PANELS ---------- */
function openPanel(type){
  closePanels();
  const p=document.createElement("div");
  p.className="internalPanel";
  p.innerHTML=`<button onclick="this.parentElement.remove()">Close</button><h2>${type}</h2>`;
  if(type==="History"){
    historyLog.forEach(h=>{
      p.innerHTML+=`<div>${h.time} — ${h.url}</div>`;
    });
  }
  if(type==="Bookmarks"){
    Object.values(bookmarks).forEach(b=>{
      p.innerHTML+=`<div>${b.name} — ${b.code}</div>`;
    });
  }
  contentArea.appendChild(p);
}
function closePanels(){
  document.querySelectorAll(".internalPanel").forEach(p=>p.remove());
}

/* ---------- MENU ---------- */
function toggleMenu(){
  menu.style.display = menu.style.display==="flex"?"none":"flex";
}
document.addEventListener("click",e=>{
  if(!menu.contains(e.target) && !e.target.textContent.includes("⋮")){
    menu.style.display="none";
  }
});

/* ---------- DEVTOOLS ---------- */
function injectDev(){
  try{
    active.iframe.contentWindow.eval(`
      var s=document.createElement('script');
      s.src='//cdn.jsdelivr.net/npm/eruda';
      document.body.appendChild(s);
      s.onload=()=>eruda.init();
    `);
  }catch{}
}
</script>

</body>
</html>
