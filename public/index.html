<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch Hub Proxy Browser</title>

<!-- UV PROXY -->
<script src="/uv/uv.bundle.js"></script>
<script src="/uv/uv.config.js"></script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
  });
}
</script>

<style>
:root{
  --bg:#0a0a0a; --panel:#121212; --border:#333; --accent:#fff; --text:#fff;
  --urlbar-bg:#000; --urlbar-outline:#fff; --btn-bg:#111; --btn-hover:#222;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{background:var(--panel);padding:16px;text-align:center;font-size:2rem;font-weight:700;border-bottom:1px solid var(--border);}
nav{display:flex;justify-content:center;gap:18px;padding:12px;background:var(--panel);border-bottom:1px solid var(--border);}
.nav-btn{padding:10px 20px;background:var(--btn-bg);border:1px solid var(--border);border-radius:8px;cursor:pointer;color:var(--text);transition:.3s;}
.nav-btn:hover{background:var(--btn-hover);}
#homeContent{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;gap:20px;}
#homeContent input{width:400px;max-width:90%;padding:14px 20px;border-radius:999px;background:var(--btn-bg);border:1px solid var(--border);color:var(--text);font-size:1.1rem;outline:none;}
#proxyOverlay{position:fixed;inset:0;background:var(--bg);display:none;flex-direction:column;z-index:9999;}
#tabsBar{display:flex;align-items:flex-end;gap:2px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);overflow-x:auto;}
.tab{position:relative;padding:8px 16px;background:var(--btn-bg);color:var(--text);border-top-left-radius:6px;border-top-right-radius:6px;cursor:pointer;display:flex;align-items:center;gap:6px;min-width:80px;justify-content:center;}
.tab.active{background:var(--bg);border-bottom:1px solid var(--bg);font-weight:700;}
.tab img{width:16px;height:16px;vertical-align:middle;}
.tab .close{margin-left:6px;font-weight:900;cursor:pointer;}
.tab + .tab{margin-left:-2px;}
#browserBar{display:flex;align-items:center;gap:6px;padding:6px;background:var(--btn-bg);border-bottom:1px solid var(--border);}
.bubble-btn{padding:6px 12px;border-radius:4px;background:var(--btn-bg);border:1px solid var(--urlbar-outline);cursor:pointer;color:var(--text);}
.bubble-btn:hover{background:var(--btn-hover);}
#urlBar{flex:1;padding:6px 12px;background:var(--urlbar-bg);border:1px solid var(--urlbar-outline);border-radius:4px;color:var(--text);outline:none;font-family:monospace;font-size:0.9rem;}
#bookmarkStar{padding:6px 12px;margin-left:4px;border-radius:4px;background:var(--btn-bg);border:1px solid var(--urlbar-outline);cursor:pointer;color:var(--text);}
#bookmarkBar{display:flex;gap:4px;padding:4px;background:var(--panel);border-bottom:1px solid var(--border);overflow-x:auto;}
.bookmark-btn{padding:4px 10px;background:var(--btn-bg);color:var(--text);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:0.85rem;}
.bookmark-btn:hover{background:var(--btn-hover);}
#frames{flex:1;position:relative;}
.proxyFrame{position:absolute;inset:0;width:100%;height:100%;border:none;display:none;}
.proxyFrame.active{display:block;}
#bookmarkModal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border:1px solid var(--border);padding:20px;border-radius:8px;display:none;flex-direction:column;gap:10px;z-index:10000;}
#bookmarkModal input{padding:6px;border-radius:4px;background:var(--btn-bg);border:1px solid var(--border);color:var(--text);}
#bookmarkModal button{padding:6px 12px;background:var(--btn-bg);border:1px solid var(--border);border-radius:4px;color:var(--text);cursor:pointer;}
#bookmarkModal button:hover{background:var(--btn-hover);}
</style>
</head>

<body>

<header>Glitch Hub</header>

<nav>
  <div class="nav-btn" onclick="window.location.href='../games/app.html'">Games</div>
  <div class="nav-btn" onclick="window.location.href='../movies/index.html'">Movies</div>
  <div class="nav-btn" onclick="window.location.href='../ai/index.html'">AI</div>
  <div class="nav-btn" onclick="window.location.href='../tools/index.html'">Tools</div>
</nav>

<div id="homeContent">
  <input id="homeSearch" placeholder="Search or enter a URL (press Enter)">
</div>

<div id="proxyOverlay">
  <div id="tabsBar"><div class="tab" onclick="newTab()">＋</div></div>
  <div id="browserBar">
    <div class="bubble-btn" onclick="goBack()">⟵</div>
    <div class="bubble-btn" onclick="goForward()">⟶</div>
    <div class="bubble-btn" onclick="refreshTab()">⟳</div>
    <input id="urlBar" spellcheck="false">
    <div class="bubble-btn" onclick="fullscreenTab()">⛶</div>
    <div class="bubble-btn" onclick="injectCode()">&lt;/&gt;</div>
    <div id="bookmarkStar" onclick="suggestBookmark()">★</div>
    <div class="bubble-btn" onclick="closeOverlay()">✕</div>
  </div>
  <div id="bookmarkBar"></div>
  <div id="frames"></div>
</div>

<div id="bookmarkModal">
  <input type="text" id="bookmarkName" placeholder="Bookmark Name">
  <input type="text" id="bookmarkCode" placeholder="Bookmarklet JS Code or URL">
  <div style="display:flex;gap:10px;justify-content:flex-end;">
    <button onclick="saveBookmark()">Save</button>
    <button onclick="closeBookmarkModal()">Cancel</button>
  </div>
</div>

<script>
const homeSearch = document.getElementById("homeSearch");
const overlay = document.getElementById("proxyOverlay");
const tabsBar = document.getElementById("tabsBar");
const frames = document.getElementById("frames");
const urlBar = document.getElementById("urlBar");
const bookmarkBar = document.getElementById("bookmarkBar");
const homeContent = document.getElementById("homeContent");
const bookmarkModal = document.getElementById("bookmarkModal");
const bookmarkNameInput = document.getElementById("bookmarkName");
const bookmarkCodeInput = document.getElementById("bookmarkCode");

let tabs = [], active = null;

function normalize(input){
  if(!input.includes(".")) return "https://www.startpage.com/sp/search?q="+encodeURIComponent(input);
  if(!input.startsWith("http")) return "https://"+input;
  return input;
}

// ===== HOME SEARCH =====
homeSearch.addEventListener("keydown", e=>{
  if(e.key==="Enter") newTab(normalize(homeSearch.value.trim()));
});

// ===== NAVIGATION BUTTONS open local paths =====
// already window.location.href in nav buttons

function newTab(url="https://www.startpage.com"){
  homeContent.style.display="none";
  const iframe = document.createElement("iframe");
  iframe.className="proxyFrame";

  const tab = document.createElement("div");
  tab.className="tab";
  const title = document.createElement("span");
  title.textContent="New Tab";
  const favicon = document.createElement("img");
  favicon.src="";

  const close = document.createElement("span");
  close.textContent="✕";
  close.className="close";

  const tabObj = {iframe, tab, title, url, favicon};
  close.onclick = e=>{ e.stopPropagation(); closeTab(tabObj); };
  tab.onclick = ()=>activate(tabObj);
  tab.append(favicon, title, close);

  tabs.splice(tabs.length-1,0,tabObj);
  tabsBar.insertBefore(tab, tabsBar.lastElementChild);
  frames.appendChild(iframe);

  iframe.src = __uv$config.prefix + __uv$config.encodeUrl(url);
  overlay.style.display="flex";
  activate(tabObj);

  iframe.onload = () => {
    try{
      const w = iframe.contentWindow;
      tabObj.title.textContent = w.document.title || "New Tab";
      const linkIcon = w.document.querySelector("link[rel~='icon']");
      if(linkIcon) tabObj.favicon.src = linkIcon.href;
    } catch{}
  };
}

function activate(t){
  tabs.forEach(x=>{x.iframe.classList.remove("active"); x.tab.classList.remove("active");});
  active = t;
  t.iframe.classList.add("active");
  t.tab.classList.add("active");
  updateUrlBar();
}

function updateUrlBar(){
  if(!active) return;
  try{
    const w = active.iframe.contentWindow;
    let href = active.url;
    if(w.location.href.includes(__uv$config.prefix)){
      const encoded = w.location.href.split(__uv$config.prefix)[1];
      href = __uv$config.decodeUrl(encoded.replace(/^\/+/,''));
    }
    urlBar.value = href;
  } catch{ urlBar.value = active.url; }
  requestAnimationFrame(updateUrlBar);
}

function closeTab(t){
  const i = tabs.indexOf(t);
  if(i>-1){t.iframe.remove(); t.tab.remove(); tabs.splice(i,1); activate(tabs[i-1]||tabs[0]||null);}
  if(tabs.length===0){overlay.style.display="none"; homeContent.style.display="flex";}
}

// ===== NAV CONTROLS =====
function goBack(){active?.iframe.contentWindow.history.back();}
function goForward(){active?.iframe.contentWindow.history.forward();}
function refreshTab(){active?.iframe.contentWindow.location.reload();}
function fullscreenTab(){active?.iframe.requestFullscreen?.();}
function injectCode(){
  if(!active) return;
  const code=`javascript:(function () {
    var script=document.createElement('script');
    script.src="//cdn.jsdelivr.net/npm/eruda";
    document.body.appendChild(script);
    script.onload = function(){eruda.init();}
  })();`;
  active.iframe.contentWindow.eval(code);
}

// ===== CLOSE OVERLAY =====
function closeOverlay(){
  overlay.style.display="none";
  homeContent.style.display="flex";
  tabs.forEach(t=>{t.iframe.remove(); t.tab.remove();});
  tabs=[];
  active=null;
  bookmarkBar.innerHTML="";
}

// ===== BOOKMARKS =====
function suggestBookmark(){
  if(!active) return;
  const w = active.iframe.contentWindow;
  let href = active.url;
  try{
    if(w.location.href.includes(__uv$config.prefix)){
      const encoded = w.location.href.split(__uv$config.prefix)[1];
      href = __uv$config.decodeUrl(encoded.replace(/^\/+/,''));
    }
  } catch{}
  bookmarkNameInput.value = w.document.title || "New Bookmark";
  bookmarkCodeInput.value = href;
  bookmarkModal.style.display="flex";
}

function closeBookmarkModal(){bookmarkModal.style.display="none";}
function saveBookmark(){
  const name = bookmarkNameInput.value.trim();
  const code = bookmarkCodeInput.value.trim();
  if(name && code) addBookmark(name, code);
  closeBookmarkModal();
}

function addBookmark(name, code){
  const btn = document.createElement("div");
  btn.className="bookmark-btn";
  btn.textContent=name;
  btn.onclick=()=>injectBookmarklet(code);
  bookmarkBar.appendChild(btn);
}
function injectBookmarklet(code){
  if(!active) return;
  active.iframe.contentWindow.eval(code);
}

// ===== URL BAR ENTER KEY =====
urlBar.addEventListener("keydown", e=>{
  if(e.key==="Enter" && active){
    active.url = urlBar.value.trim();
    active.iframe.src = __uv$config.prefix + __uv$config.encodeUrl(active.url);
  }
});
</script>
</body>
</html>
