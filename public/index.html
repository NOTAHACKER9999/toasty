<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Proxy Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#111;color:#fff;overflow:hidden}

/* ---------- HOME ---------- */
#home{
  position:absolute;inset:0;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:20px;z-index:1
}
#home input{
  width:420px;padding:14px;
  font-size:18px;border-radius:30px;
  border:none;outline:none
}
.homeBtns button{
  padding:12px 22px;
  background:#000;border:1px solid red;
  color:red;font-size:16px;
  cursor:pointer
}

/* ---------- OVERLAY ---------- */
#overlay{
  position:absolute;inset:0;
  display:none;flex-direction:column;
  background:#111;z-index:10
}

/* ---------- TOP BAR ---------- */
#topBar{
  height:44px;background:#1a1a1a;
  display:flex;align-items:center;
  padding:0 8px;gap:8px;z-index:20
}
#tabs{display:flex;gap:4px;flex:1}
.tab{
  background:#222;padding:6px 10px;
  border-radius:6px;cursor:pointer;
  display:flex;align-items:center;gap:6px
}
.tab.active{background:#333}
.tab img{width:14px;height:14px}

#urlBar{
  flex:3;padding:6px 10px;
  border-radius:20px;border:none;
  outline:none
}

#closeBtn{
  background:red;color:#000;
  border:none;padding:6px 10px;
  cursor:pointer
}

#dots{
  font-size:20px;cursor:pointer;
  padding:4px 8px
}

/* ---------- 3 DOT MENU ---------- */
#menu{
  position:absolute;top:44px;right:10px;
  background:#222;border-radius:10px;
  display:none;flex-direction:column;
  min-width:160px;z-index:30
}
#menu button{
  background:none;border:none;
  color:#fff;text-align:left;
  padding:10px;cursor:pointer
}
#menu button:hover{background:#333}

/* ---------- BOOKMARK BAR ---------- */
#bookmarkBar{
  height:32px;background:#191919;
  display:flex;gap:6px;
  padding:4px 6px;overflow-x:auto
}
.bm{
  background:#222;padding:4px 8px;
  border-radius:6px;cursor:pointer;
  white-space:nowrap
}

/* ---------- CONTENT ---------- */
#content{
  position:relative;flex:1
}
iframe{
  position:absolute;inset:0;
  width:100%;height:100%;
  border:none;background:#000
}

/* ---------- PANEL OVERLAY ---------- */
.panel{
  position:absolute;inset:50px;
  background:#111;border:1px solid #333;
  border-radius:14px;padding:20px;
  overflow:auto;z-index:25
}
.panel h2{margin-top:0}

/* ---------- HISTORY ---------- */
.histItem{
  padding:10px;border-bottom:1px solid #333;
  cursor:pointer
}
.histItem:hover{background:#222}
</style>
</head>

<body>

<!-- HOME -->
<div id="home">
  <input id="homeSearch" placeholder="Search or enter URL">
  <div class="homeBtns">
    <button onclick="openBrowser()">Browser</button>
    <button onclick="alert('Games placeholder')">Games</button>
    <button onclick="alert('Stuff placeholder')">Stuff</button>
  </div>
</div>

<!-- OVERLAY -->
<div id="overlay">

  <div id="topBar">
    <div id="tabs"></div>
    <input id="urlBar">
    <div id="dots">â‹®</div>
    <button id="closeBtn" onclick="closeBrowser()">X</button>
  </div>

  <div id="bookmarkBar"></div>

  <div id="menu" onmouseleave="menu.style.display='none'">
    <button onclick="newTab()">New Tab</button>
    <button onclick="openHistory()">History</button>
    <button onclick="openBookmarks()">Bookmarks</button>
    <button onclick="injectDevTools()">Dev Tools</button>
    <button onclick="alert('Settings coming soon')">Settings</button>
  </div>

  <div id="content"></div>
</div>

<script>
const home=document.getElementById("home");
const overlay=document.getElementById("overlay");
const content=document.getElementById("content");
const tabsDiv=document.getElementById("tabs");
const urlBar=document.getElementById("urlBar");
const bookmarkBar=document.getElementById("bookmarkBar");
const menu=document.getElementById("menu");
const dots=document.getElementById("dots");

let tabs=[],activeTab=null;
let historyLog=JSON.parse(localStorage.getItem("history")||"[]");
let bookmarks=JSON.parse(localStorage.getItem("bookmarks")||"{}");
let typing=false;

/* ---------- HOME ---------- */
homeSearch.onkeydown=e=>{
  if(e.key==="Enter"){
    openBrowser();
    newTab(homeSearch.value);
  }
};

/* ---------- BROWSER ---------- */
function openBrowser(){
  home.style.display="none";
  overlay.style.display="flex";
  if(!tabs.length) newTab();
}

function closeBrowser(){
  overlay.style.display="none";
  home.style.display="flex";
}

function newTab(url="https://duckduckgo.com"){
  const iframe=document.createElement("iframe");
  iframe.src=url;
  content.appendChild(iframe);

  const tab={
    iframe,url,title:"New Tab",icon:""
  };
  tabs.push(tab);
  setActive(tab);

  iframe.onload=()=>{
    try{
      tab.title=iframe.contentDocument.title||url;
      tab.icon=iframe.contentDocument.querySelector("link[rel~='icon']")?.href||"";
      logHistory(iframe.src);
      renderTabs();
    }catch{}
  };
}

function setActive(tab){
  tabs.forEach(t=>t.iframe.style.display="none");
  tab.iframe.style.display="block";
  activeTab=tab;
  renderTabs();
}

function renderTabs(){
  tabsDiv.innerHTML="";
  tabs.forEach(t=>{
    const d=document.createElement("div");
    d.className="tab"+(t===activeTab?" active":"");
    d.onclick=()=>setActive(t);
    if(t.icon){
      const i=document.createElement("img");
      i.src=t.icon;d.appendChild(i);
    }
    d.appendChild(document.createTextNode(t.title));
    tabsDiv.appendChild(d);
  });
}

/* ---------- URL BAR ---------- */
urlBar.onfocus=()=>typing=true;
urlBar.onblur=()=>typing=false;

urlBar.onkeydown=e=>{
  if(e.key==="Enter"){
    activeTab.iframe.src=urlBar.value;
  }
};

setInterval(()=>{
  if(activeTab&&!typing){
    try{
      urlBar.value=activeTab.iframe.contentWindow.location.href;
    }catch{}
  }
},500);

/* ---------- HISTORY ---------- */
function logHistory(url){
  historyLog.push({url,time:new Date().toLocaleString()});
  localStorage.setItem("history",JSON.stringify(historyLog));
}

function openHistory(){
  showPanel("History",panel=>{
    const clear=document.createElement("button");
    clear.textContent="Clear History";
    clear.onclick=()=>{
      historyLog=[];
      localStorage.removeItem("history");
      openHistory();
    };
    panel.appendChild(clear);

    historyLog.slice().reverse().forEach(h=>{
      const d=document.createElement("div");
      d.className="histItem";
      d.innerHTML=`<b>${h.url}</b><br><small>${h.time}</small>`;
      d.onclick=()=>newTab(h.url);
      panel.appendChild(d);
    });
  });
}

/* ---------- BOOKMARKS ---------- */
function renderBookmarks(){
  bookmarkBar.innerHTML="";
  Object.keys(bookmarks).forEach(url=>{
    const b=document.createElement("div");
    b.className="bm";
    b.textContent=bookmarks[url];
    b.onclick=()=>newTab(url);
    bookmarkBar.appendChild(b);
  });
}

function openBookmarks(){
  showPanel("Bookmarks",panel=>{
    Object.keys(bookmarks).forEach(url=>{
      panel.innerHTML+=`<div>${bookmarks[url]}<br><small>${url}</small></div>`;
    });
  });
}

/* ---------- PANELS ---------- */
function showPanel(title,build){
  document.querySelectorAll(".panel").forEach(p=>p.remove());
  const p=document.createElement("div");
  p.className="panel";
  p.innerHTML=`<h2>${title}</h2>`;
  build(p);
  content.appendChild(p);
}

/* ---------- MENU ---------- */
dots.onclick=()=>{
  menu.style.display=menu.style.display==="flex"?"none":"flex";
};

/* ---------- DEVTOOLS ---------- */
function injectDevTools(){
  try{
    const d=activeTab.iframe.contentDocument;
    const s=d.createElement("script");
    s.src="//cdn.jsdelivr.net/npm/eruda";
    s.onload=()=>d.body.appendChild(
      Object.assign(d.createElement("script"),{textContent:"eruda.init();"})
    );
    d.body.appendChild(s);
  }catch{}
}

renderBookmarks();
</script>

</body>
</html>
