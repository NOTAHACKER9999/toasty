<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#050505;
  --panel:rgba(20,20,20,0.95);
  --card:rgba(30,30,30,0.95);
  --border:#2f2f2f;
  --accent:#ff2d2d;
  --text:#e0e0e0;
  --hover:#2a2a2a;
  --transition:all .3s ease;
}

*{box-sizing:border-box;}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'Segoe UI',Arial,sans-serif;
  height:100vh;overflow:hidden;
}

#app{display:flex;height:100vh;}

#sidebar{
  width:220px;background:var(--panel);
  border-right:1px solid var(--border);
  padding:20px 10px;
  display:flex;flex-direction:column;gap:10px;
  height:100vh;overflow-y:auto;
}

#sidebar button{
  background:none;border:none;color:var(--text);
  padding:12px;border-radius:8px;
  text-align:left;cursor:pointer;
  position:relative;
}

#sidebar button::after{
  content:"";position:absolute;left:0;bottom:0;
  width:0;height:2px;background:var(--accent);
  transition:var(--transition);
}

#sidebar button:hover::after,
#sidebar button.active::after{width:100%;}

#main{flex:1;display:flex;flex-direction:column;overflow:hidden;}

#topbar{
  height:56px;background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  justify-content:space-between;
  padding:0 16px;font-size:1.3rem;font-weight:700;
}

#search-input{
  width:220px;padding:6px 10px;
  background:var(--panel);border:1px solid var(--border);
  color:var(--text);border-radius:8px;
}

#search-results{
  position:absolute;top:36px;right:0;
  width:240px;max-height:300px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  overflow-y:auto;display:none;
  z-index:1000;
}

#content{flex:1;overflow:auto;padding:16px;}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:14px;overflow:hidden;
  cursor:pointer;
  transition:var(--transition);
}
.card:hover{transform:translateY(-4px);}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover;}
.card h3{text-align:center;font-size:.9rem;padding:8px;}

.section-title{
  margin:16px 0 12px;
  color:var(--accent);font-weight:700;
}

iframe{
  width:100%;height:65vh;border:none;
  background:black;border-radius:12px;
  opacity:0;transition:.4s;
}
iframe.loaded{opacity:1;}

.game-actions-bar{
  display:flex;gap:8px;margin:8px 0;
}
.game-actions-bar button{
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 14px;border-radius:10px;
  cursor:pointer;font-size:1.2rem;
}
.favorite.active{color:var(--accent);}

#clipboard-popup{
  position:fixed;bottom:30px;left:50%;
  transform:translateX(-50%);
  background:var(--panel);padding:12px 20px;
  border-radius:12px;opacity:0;
  transition:.3s;pointer-events:none;
}
#clipboard-popup.show{opacity:1;}
</style>
</head>

<body>
<div id="app">
  <div id="sidebar"></div>

  <div id="main">
    <div id="topbar">
      <span>Home</span>
      <input id="search-input" placeholder="Search games...">
      <div id="search-results"></div>
    </div>
    <div id="content"></div>
  </div>
</div>

<div id="clipboard-popup">Link copied!</div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Hypper-Drive-2/refs/heads/main/Games/Zones.json";
const ERROR_404 = "https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Malfunction/refs/heads/main/Pages/404.html";

const ZONE_TYPES = {
  "Home":"Home","PC":"PC","Mobile":"Moblie","N64":"N64","NDS":"NDS",
  "PS1":"PS1","PSP":"PSP","Game Boy":"GB","Game Boy Advance":"GBA",
  "Game Boy Color":"GBC","NES":"NES","SNES":"SNES","Sega Genesis":"SG",
  "Sega Saturn":"SSat","Neo Geo Pocket Color":"NGPC","MS-DOS":"MSDOS",
  "Atari Jaguar":"AJ","Arcade":"Arcade","Sega Game Gear":"SGG",
  "Pico 8":"P8","Atari Lynx":"AL","Atari 2600":"A2600"
};

let recents = JSON.parse(localStorage.getItem("recentGames")||"[]");
let favorites = JSON.parse(localStorage.getItem("favoriteGames")||"[]");
let allGames = [];

const sidebar = document.getElementById("sidebar");
const content = document.getElementById("content");
const searchInput = document.getElementById("search-input");
const searchResults = document.getElementById("search-results");
const topbarTitle = document.querySelector("#topbar span");

Object.keys(ZONE_TYPES).forEach(z=>{
  const b=document.createElement("button");
  b.textContent=z;
  b.onclick=()=>navigateZone(z);
  sidebar.appendChild(b);
});

function setActive(zone){
  [...sidebar.children].forEach(b=>{
    b.classList.toggle("active",b.textContent===zone);
  });
  topbarTitle.textContent=zone;
}

function renderGrid(list){
  const g=document.createElement("div");
  g.className="grid";
  list.forEach(game=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<img src="${game.cover}"><h3>${game.name}</h3>`;
    c.onclick=()=>openGame(game);
    g.appendChild(c);
  });
  return g;
}

function renderHome(){
  setActive("Home");
  content.innerHTML="";
  if(recents.length)content.appendChild(renderGrid(recents.slice(-10).reverse()));
}

function renderZone(zone){
  setActive(zone);
  content.innerHTML="";
  const list=allGames.filter(g=>g.type.toLowerCase()===ZONE_TYPES[zone].toLowerCase());
  list.length?content.appendChild(renderGrid(list)):renderError();
}

async function openGame(game){
  setActive(game.type);
  content.innerHTML=`
    <iframe id="player" src="about:blank"></iframe>
    <div class="game-actions-bar">
      <button class="favorite ${favorites.some(f=>f.name===game.name)?'active':''}">â˜…</button>
      <button class="fullscreen">â›¶</button>
      <button class="newtab">â†—</button>
      <button class="share">ðŸ”—</button>
    </div>
  `;

  const iframe=document.getElementById("player");
  const res=await fetch(game.url);
  const html=await res.text();
  iframe.contentWindow.document.open();
  iframe.contentWindow.document.write(html);
  iframe.contentWindow.document.close();
  iframe.classList.add("loaded");

  document.querySelector(".fullscreen").onclick=()=>{
    iframe.requestFullscreen();
  };

  document.querySelector(".newtab").onclick=()=>{
    const win=window.open("about:blank","_blank");
    if(win)win.focus();
  };

  document.querySelector(".share").onclick=()=>{
    navigator.clipboard.writeText(location.href);
    const p=document.getElementById("clipboard-popup");
    p.classList.add("show");
    setTimeout(()=>p.classList.remove("show"),2000);
  };
}

async function renderError(){
  const iframe=document.createElement("iframe");
  iframe.src="about:blank";
  const res=await fetch(ERROR_404);
  const html=await res.text();
  content.innerHTML="";
  content.appendChild(iframe);
  iframe.contentWindow.document.open();
  iframe.contentWindow.document.write(html);
  iframe.contentWindow.document.close();
}

function navigateZone(zone){
  zone==="Home"?renderHome():renderZone(zone);
}

fetch(JSON_URL).then(r=>r.json()).then(g=>{
  allGames=g;
  renderHome();
});
</script>
</body>
</html>
